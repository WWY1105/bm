app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"keeper/index.html",controller:"HomeCtr"}).when("/shop",{templateUrl:"keeper/Shop/index.html",controller:"ShopCtr"}).when("/shop/add",{templateUrl:"keeper/Shop/add.html",controller:"ShopAddCtr"}).when("/shop/add2",{templateUrl:"keeper/Shop/add2.html",controller:"ShopAdd2Ctr"}).when("/shop/add3",{templateUrl:"keeper/Shop/add3.html",controller:"ShopAdd3Ctr"}).when("/shop/add4",{templateUrl:"keeper/Shop/add4.html",controller:"ShopAdd4Ctr"}).when("/shop/add5",{templateUrl:"keeper/Shop/add5.html",controller:"ShopAdd5Ctr"}).when("/shop/edit",{templateUrl:"keeper/Shop/edit.html",controller:"ShopAddCtr"}).when("/shop/businesstime",{templateUrl:"keeper/Shop/businesstime.html",controller:"ShopBusinesstimeCtr"}).when("/shop/add2re",{templateUrl:"keeper/Shop/add2re.html",controller:"TablesCtr"}).when("/tables",{templateUrl:"keeper/Shop/tables.html",controller:"TablesCtr"}).when("/table/tables",{templateUrl:"keeper/Table/tables.html",controller:"TablesCtr"}).when("/table/regions",{templateUrl:"keeper/Table/regions.html",controller:"RegionsCtr"}).when("/table/region/:id",{templateUrl:"keeper/Table/regionDetail.html",controller:"RegionDetailCtr"}).when("/table/reserve",{templateUrl:"keeper/Table/reserve/index.html",controller:"ReserveCtr"}).when("/table/reserve/:aid",{templateUrl:"keeper/Table/reserve/detail.html",controller:"ReserveDetailCtr"}).when("/rule/source",{templateUrl:"keeper/rule/source/index.html",controller:"sourceCtr"}).when("/rule/addsource",{templateUrl:"keeper/rule/source/addsource.html",controller:"addsourceCtr"}).when("/rule/editsource/:id",{templateUrl:"keeper/rule/source/editsource.html",controller:"editsourceCtr"}).when("/staff",{templateUrl:"keeper/Staff/show.html",controller:"StaffShowCtr"}).when("/staff/duty",{templateUrl:"keeper/Staff/duty/index.html",controller:"DutyCtr"}).when("/staff/duty/:date",{templateUrl:"keeper/Staff/duty/edit.html",controller:"DutyEditCtr"}).when("/staff/templateDuty",{templateUrl:"keeper/Staff/duty/templateDuty.html",controller:"TemplateDutyCtr"}).when("/staff/staffedit/:guestid",{templateUrl:"keeper/Staff/staffedit.html",controller:"StaffeditCtr"}).when("/staff/staffoperation/:guestid",{templateUrl:"keeper/Staff/staffoperation.html",controller:"Staffoperation"}).when("/staff/staffadd",{templateUrl:"keeper/Staff/staffadd.html",controller:"StaffaddCtr"}).when("/comment",{templateUrl:"keeper/comment.html",controller:"CommentCtr"}).when("/customer/charge/:userId",{templateUrl:"admin/customer/charge.html",controller:"CustomerChargeCtr"}).when("/customer/point/:userId",{templateUrl:"admin/customer/point.html",controller:"CustomerPointCtr"}).when("/customer/coupon/:userId",{templateUrl:"admin/customer/coupon.html",controller:"CustomerCouponCtr"}).when("/customer/upgrade/:userId",{templateUrl:"admin/customer/upgrade.html",controller:"CustomerUpgradeCtr"}).when("/customer/add",{templateUrl:"keeper/customer/add.html",controller:"CustomerAddCtr"}).when("/customer",{templateUrl:"keeper/customer/index.html",controller:"CustomerCtr"}).when("/customer/tag",{templateUrl:"keeper/customer/tag.html",controller:"CustomerTagCtr"}).when("/customer/:userId",{templateUrl:"keeper/customer/index.html",controller:"CustomerCtr"}).when("/customer/details/:userId",{templateUrl:"admin/customer/details.html",controller:"CustomerDetailsCtr"}).when("/rule",{templateUrl:"keeper/rule/index.html",controller:"RuleCtr"}).when("/rule/coupon",{templateUrl:"keeper/rule/coupon.html",controller:"RuleCouponCtr"}).when("/rule/reward",{templateUrl:"keeper/rule/reward.html",controller:"RuleRewardCtr"}).when("/rule/member",{templateUrl:"keeper/rule/member.html",controller:"RuleMemberCtr"}).when("/staff/password/:guestid",{templateUrl:"keeper/Staff/password.html",controller:"passwordCtr"}).when("/password",{templateUrl:"my/password.html",controller:"edit_passwordCtr"}).when("/devices",{templateUrl:"keeper/devices/index.html",controller:"DevicesCtr"}).when("/mall/dish",{templateUrl:"keeper/mall/dish/index.html",controller:"DishCtr"}).when("/mall/category",{templateUrl:"keeper/mall/category/index.html",controller:"CategoryCtr"}).when("/mall/meal",{templateUrl:"keeper/mall/meal/index.html",controller:"MealCtr"}).when("/mall/buy",{templateUrl:"keeper/mall/buy/index.html",controller:"BuyCtr"}).when("/doc",{templateUrl:"keeper/doc/index.html?v=2",controller:"DocCtr"}).when("/finance",{templateUrl:"keeper/finance/index.html",controller:"FinanceCtr"}).when("/finance/search",{templateUrl:"keeper/finance/search.html",controller:"FinanceSearchCtr"}).when("/finance/searchday",{templateUrl:"keeper/finance/searchday.html",controller:"FinanceSearchDayCtr"}).otherwise({redirectTo:"/"})}]),app.controller("HomeCtr",["$scope",function(e){e.ruleDic={nonParticipations:"不参与活动商品",periods:"有效时段",time:"时间",shops:"分店"},e.config.breadset=[{name:"首页"}],e.view={customerCount:{},shop:[]},customerCount=ajaxSendFn({},"/customer/count","GET").result||[];for(var t in customerCount)e.view.customerCount[customerCount[t].type]=customerCount[t];e.view.rule=ajaxSendFn({},"/activity","GET").result||[];for(t in e.view.rule){tem=e.view.rule[t],e.view.rule[t].icon={};for(y in tem.rules)tem.rules[y].type=tem.rules[y].type.split("_"),e.view.rule[t].icon[tem.rules[y].type[0]]=1}e.view.satisfaction={1001:"很棒",1002:"一般",1003:"较差"};var a=ajaxSendFn({},"/comments/shop","GET").result;a&&(e.view.comment=a.items||[])}]),app.controller("ShopCtr",["$scope","$location","$filter",function(e,t,a){if(e.config.breadset=[{name:"我的门店"}],e.shop=ajaxSendFn({},"/shops/shop","GET").result,e.shop.id&&(e.videoInfo=ajaxSendFn({},"/shop/videos/shop/"+e.shop.id,"GET").result),!e.shop.businessTimes)return void t.path("/shop/add");if("1003"==e.shop.state){e.qrcode={};var s=ajaxSendFn({},"/shops/shop/qrcode","GET");200==s.code&&(e.qrcode=s.result)}e.shopType=[{code:"1001",text:"支持桌边付"},{code:"1002",text:"不支持桌边付"}],e.qrcodeType=[{code:"1001",text:"上宾二维码"},{code:"1002",text:"微信二维码"}],e.stageCheck=[{code:"101",text:"展示二维码等待捷账宝扫描"},{code:"102",text:"用户主动输入金额"}],e.tableCheck=[{code:"100",text:"点击买单后呼叫捷账宝"},{code:"101",text:"展示二维码等待捷账宝扫描"},{code:"102",text:"用户主动输入金额"}],e.view={},e.tem={uploadTitle:"选择要上传的图片"},e.tem.type={1001:"早市",1002:"午市",1003:"下午茶",1004:"晚市",1005:"夜宵"},e.authed={1001:"创建中",1002:"认证审核中",1003:"已通过审核",1004:"关闭审核中",1005:"停用"},e.view={businesstime:{1001:{startTime:"",endTime:""},1002:{startTime:"",endTime:""},1003:{startTime:"",endTime:""},1004:{startTime:"",endTime:""},1005:{startTime:"",endTime:""}}},e.shop.openingDay=a("ltdate")(e.shop.openingDay),e.addpic=function(){e.view.materials=ajaxSendFn({count:10},"/materials","GET").result||[],e.view.groups=ajaxSendFn({},"/materials/group","GET").result||[],e.view.select=-1,e.view.leftIndex=-2,$("#addpic").modal("show")},e.addVid=function(){e.view.video=ajaxSendFn({count:10},"/videos","GET").result||[],e.view.vidgroups=ajaxSendFn({},"/videos/group","GET").result||[],$("#addvid").modal("show")},e.downloadFn=function(e){var t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","");var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!0,!1,0,null),t.dispatchEvent(a)},e.removeImg=function(t){removere=ajaxSendFn({},"/pic/"+e.shop.picUrls[t].id,"DELETE"),200==removere.code&&e.shop.picUrls.splice(t,1)},e.setCover=function(e){var t=ajaxSendFn({},"/pic/"+e+"/cover","POST");200==t.code?alert("设置成功"):errorMsg(t)},e.removeCover=function(e){var t=ajaxSendFn({},"/pic/"+e+"/cover","DELETE");200==t.code?alert("成功取消"):errorMsg(t)},e.bigpicshow=function(t){e.view.bigpic=t.substring(0,t.lastIndexOf(".",t))+"_1"+t.substring(t.lastIndexOf(".",t)),$("#bigpic").modal("show")},e.deleteShopFn=function(){if(confirm("是否确定申请关闭?")){var t=ajaxSendFn({},"/shops/"+e.shop.id,"POST");200==t.code?alert("申请关闭成功！"):errorMsg(t)}},e.openShopFn=function(){var e=ajaxSendFn({},"/shops/shop/audit","POST");200==e.code?alert("启用成功！"):errorMsg(e)},e.shopedit=function(){if(!e.posts){e.posts=e.shop,e.view.style=ajaxSendFn({},"/dict/CUISINE/item","GET").result;for(var t=0;t<e.view.style.length;t++)e.posts.cuisineText==e.view.style[t].text&&(e.posts.cuisine=e.view.style[t].code);e.area={area1:e.posts.area.substring(0,2)+"0000",area2:e.posts.area.substring(0,4)+"00",area3:e.posts.area},e.areaJson1=ajaxSendFn({},"/dict/area","GET").result,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3||(e.area.area2=e.posts.area,delete e.area.area3),e.area1change=function(t){e.areaChanged=!0,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.area.area2=e.areaJson2[0].code,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},e.area2change=function(t){e.areaChanged=!0,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3}}$("#shopedit").modal("show")},e.senposts=function(){e.config.modalLink="",sends={tel:e.posts.tel,openingDay:a("date")(e.posts.openingDay,"yyyy-MM-dd HH:mm:ss"),cuisine:e.posts.cuisine,avgprice:e.posts.avgprice,area:e.areaChanged?e.area.area3||e.area.area2:e.posts.area,address:e.posts.address,latitude:e.posts.latitude||"",longitude:e.posts.longitude||"",shopType:e.posts.shopType||"",tableCheck:e.posts.tableCheck||"",stageCheck:e.posts.stageCheck||"",parkingDescription:e.posts.parkingDescription||"",description:e.posts.description||"",id:e.posts.id},sendJson=JSON.stringify(sends),postsend=ajaxSendFn(sendJson,"/shops/shop","POST",1),200==postsend.code?($("#shopedit").modal("hide"),alert("保存成功")):alert(postsend.message)},e.changeFn=function(t,a){e.view.select==t?e.view.select=-1:e.view.select=t},e.changevidFn=function(t,a){console.log(a),e.video=a,e.view.select==t?e.view.select=-1:e.view.select=t},e.imgUpload=function(t){return t.files[0].size>5242880?void alert("图片不得大于5M，图片格式为png,jpg,jpeg,bmp"):(POSTurl=basicUrl+"/materials?",options={url:POSTurl+sortUrl(),type:"POST",success:function(t){200===t.code?e.$apply(function(){e.view.materials=ajaxSendFn({count:10},"/materials","GET").result,e.view.select=0}):alert(t.message)}},void $("#iimgform").ajaxSubmit(options))},e.groupList=function(t){url="/materials",t>=0&&(url="/materials/group/"+e.view.groups[t].id+"/materials"),t==-1&&(url="/materials/group/materials"),e.view.materials=ajaxSendFn({count:10},url,"GET").result,e.view.leftIndex=t},e.vidgroupList=function(t){url="/videos",t>=0&&(url="/videos/group/"+e.view.groups[t].id+"/videos"),t==-1&&(url="/videos/group/videos"),e.view.video=ajaxSendFn({count:10},url,"GET").result,e.view.leftIndex=t},e.sendGroup=function(){var t=ajaxSendFn({name:e.post.name},"/materials/group","POST");200===t.code?(e.view.checkName=!1,e.view.groups=ajaxSendFn({},"/materials/group","GET").result):alert(t.message)},e.pageChange=function(){url="/materials",e.view.leftIndex>=0&&(url="/materials/group/"+e.view.groups[e.view.leftIndex].id+"/materials"),e.view.leftIndex==-1&&(url="/materials/group/materials");var t={page:e.view.materials.page,count:e.view.materials.count};e.view.materials=ajaxSendFn(t,url,"GET").result},e.vidUpload=function(t){return t.files[0].size>10485760?void alert("视频不得大于10M"):(POSTurl=basicUrl+"/videos?",options={url:POSTurl+sortUrl(),type:"POST",success:function(t){200===t.code?e.$apply(function(){e.view.materials=ajaxSendFn({count:10},"/videos","GET").result,e.view.select=0}):alert(t.message)}},void $("#iimgform1").ajaxSubmit(options))},e.submitFn=function(){if(e.view.select>=0){var t=ajaxSendFn({id:e.view.materials.items[e.view.select].id},"/pic/shop","POST");200==t.code?(e.shop.picUrls.push(t.result),$("#addpic").modal("hide")):alert(t.message)}},e.view.types=ajaxSendFn({},"/shops/cashier","GET").result,e.auth=function(){if(!e.view.type)return void alert("请先选择收银系统");var t=ajaxSendFn({},"/shops/cashier/"+e.view.type,"GET");200==t.code?location.href=t.result.url:alert("授权失败，请重试！")},e.view.introduction=ajaxSendFn({},"/shops/shop/introduction","GET").result||[{}],e.view.videos=ajaxSendFn({},"/shop/videos/shop","GET").result||[{}],e.introductionFn=function(){var t=[];for(var a in e.view.introduction){var s={};e.view.introduction[a].url&&(s.url=e.view.introduction[a].url),e.view.introduction[a].title&&(s.title=e.view.introduction[a].title),e.view.introduction[a].content&&(s.content=e.view.introduction[a].content),t.push(s)}var o=ajaxSendFn(JSON.stringify(t),"/shops/shop/introduction","POST");200==o.code?(e.cancelIntroductionFn(),$("#introduction").modal("hide")):alert("操作失败，请重试！")},e.videoFn=function(){var t={id:e.video.id},a=ajaxSendFn(JSON.stringify(t),"/shop/videos","POST");200==a.code?(e.cancelvideoFn(),alert("操作成功！"),$("#addvid").modal("hide")):alert("操作失败，请重试！")},e.coverFn=function(t){var a=ajaxSendFn({},"/shop/videos/"+t+"/cover","POST");200==a.code?(e.cancelcoverFn(),$("#cover").modal("hide")):alert("操作失败，请重试！")},e.removecoverFn=function(t){var a=ajaxSendFn({},"/shop/videos/"+t+"/cover","DELETE");200==a.code?(e.cancelcoverFn(),$("#cover").modal("hide")):alert("操作失败，请重试！")},e.cancelvideoFn=function(){$("#addvidpic").modal("hide"),e.view.videos=ajaxSendFn({},"/shop/videos/shop","GET").result||[{}]},e.cancelcoverFn=function(){$("#cover").modal("hide"),e.view.videos=ajaxSendFn({},"/shop/videos/shop","GET").result||[{}]},e.cancelIntroductionFn=function(){$("#introduction").modal("hide"),e.view.introduction=ajaxSendFn({},"/shops/shop/introduction","GET").result||[{}]}}]),app.controller("ShopAddCtr",["$scope","$filter","$location",function(e,t,a){if(e.tem={uploadTitle:"选择要上传的图片"},e.areaChanged=!1,e.getShop=ajaxSendFn({},"/shops/shop","GET").result,e.posts=e.getShop,!e.posts.openingDay){var s=new Date;e.posts.openingDay=t("date")(s,"yyyy-MM-dd HH:mm:ss")}e.posts.openingDay=new Date(Date.parse(e.posts.openingDay.replace(/-/g,"/"))),e.view={picurl:{}},e.view.style=ajaxSendFn({},"/dict/CUISINE/item","GET").result,e.area={area1:e.posts.area.substring(0,2)+"0000",area2:e.posts.area.substring(0,4)+"00",area3:e.posts.area},e.areaJson1=ajaxSendFn({},"/dict/area","GET").result,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3||(e.area.area2=e.posts.area,delete e.area.area3),e.view.picurl=ajaxSendFn({source:"9002"},"/pic/shop","GET").result||[],e.area1change=function(t){e.areaChanged=!0,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.area.area2=e.areaJson2[0].code,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},e.area2change=function(t){e.areaChanged=!0,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},mapFn=function(t){t.latitude&&t.longitude&&(e.view.map="http://restapi.amap.com/v3/staticmap?zoom=14&size=200*120&markers=-1,http://webapi.amap.com/images/1.png,0:"+t.longitude+","+t.latitude+"&key=ee95e52bf08006f63fd29bcfbcf21df0",console.log(e.view.map))},initialize=function(t,a){function s(){var s;AMap.service(["AMap.Geocoder"],function(){s=new AMap.Geocoder({radius:5e3}),s.getLocation(t.city+t.address,function(t,s){if("complete"===t&&"OK"===s.info){var r=new Array;r=s.geocodes,1==a?latlng=o(0,r[0],e.posts):latlng=o(0,r[0]),n.setFitView()}})})}function o(t,a,s){if(e.posts.latitude&&e.posts.longitude&&!s)var o=e.posts.latitude,l=e.posts.longitude;else var l=a.location.getLng(),o=a.location.getLat();e.view.latitude=o,e.view.longitude=l;var d={map:n,icon:"http://webapi.amap.com/images/"+(t+1)+".png",position:new AMap.LngLat(l,o),draggable:!0,cursor:"move",raiseOnDrag:!0},c=new AMap.Marker(d);r.push(new AMap.LngLat(l,o));var u=new AMap.InfoWindow({content:a.formattedAddress,autoMove:!0,size:new AMap.Size(150,0),offset:{x:0,y:-30}});i.push(u);var p=function(t){e.view.latitude=c.getPosition().lat,e.view.longitude=c.getPosition().lng};AMap.event.addListener(c,"dragend",p)}t.address&&""!=t.address||(t.address=t.qu);var n,r=new Array,i=new Array;n=new AMap.Map(t.id),s()},mapFn(e.posts),e.mapModal=function(){temcity=e.getShop.areaText.split("省"),2==temcity.length&&(temcity[0]=temcity[1]),temcity=temcity[0].split("市");var t={id:"mapin",latitude:e.posts.latitude,longitude:e.posts.longitude,city:temcity[0]+"市",qu:temcity[1],address:e.posts.address};initialize(t),$("#map").modal("show")},e.addpic=function(){e.view.materials=ajaxSendFn({count:10},"/materials","GET").result||[],e.view.groups=ajaxSendFn({},"/materials/group","GET").result||[],e.view.select=-1,e.view.leftIndex=-2,$("#addpic").modal("show")},e.senposts=function(s){e.config.modalLink="",sends={tel:e.posts.tel,openingDay:t("date")(e.posts.openingDay,"yyyy-MM-dd HH:mm:ss"),cuisine:e.posts.cuisine,avgprice:e.posts.avgprice,area:e.areaChanged?e.area.area3||e.area.area2:e.posts.area,address:e.posts.address,latitude:e.posts.latitude,longitude:e.posts.longitude,parkingDescription:e.posts.parkingDescription,description:e.posts.description,id:e.posts.id},sendJson=JSON.stringify(sends),postsend=ajaxSendFn(sendJson,"/shops/shop","POST",1),200==postsend.code?s?(alert("保存成功"),a.path("/shop/")):"1002"==e.getShop.shopType?a.path("/shop/add3/"):a.path("/shop/add2/"):alert(postsend.message)},e.resetpostion=function(t){temcity=ajaxSendFn({},"/dict/AREA/"+e.posts.area+"/text","GET").result.text,temcity=temcity.split("省"),2==temcity.length&&(temcity[0]=temcity[1]),temcity=temcity[0].split("市");var a={id:"mapin",latitude:e.posts.latitude,longitude:e.posts.longitude,city:temcity[0]+"市",qu:temcity[1],address:e.posts.address};initialize(a,1),$("#map").modal("show")},e.imgEditFn=function(e){console.log(e.target)},e.setpostion=function(){e.posts.latitude=e.view.latitude,e.posts.longitude=e.view.longitude,mapFn(e.posts),$("#map").modal("hide")},e.removeImg=function(t){removere=ajaxSendFn({},"/pic/"+e.view.picurl[t].id,"DELETE"),200==removere.code&&(e.view.picurl.splice(t,1),console.log(e.view.picurl))},e.setCover=function(e){var t=ajaxSendFn({},"/pic/"+e+"/cover","POST");200==t.code?alert("设置成功"):errorMsg(t)},e.removeCover=function(e){var t=ajaxSendFn({},"/pic/"+e+"/cover","DELETE");200==t.code?alert("成功取消"):errorMsg(t)},e.bigpicshwo=function(t){e.view.bigpic=t.substring(0,t.lastIndexOf(".",t))+"_1"+t.substring(t.lastIndexOf(".",t)),$("#bigpic").modal("show")},e.changeFn=function(t){e.view.select==t?e.view.select=-1:e.view.select=t},e.imgUpload=function(t){return t.files[0].size>5242880?void alert("图片不得大于5M，图片格式为png,jpg,jpeg,bmp"):(POSTurl=basicUrl+"/materials?",options={url:POSTurl+sortUrl(),type:"POST",success:function(t){200===t.code?e.$apply(function(){e.view.materials=ajaxSendFn({count:10},"/materials","GET").result,e.view.select=0}):alert(t.message)}},void $("#iimgform").ajaxSubmit(options))},e.groupList=function(t){url="/materials",t>=0&&(url="/materials/group/"+e.view.groups[t].id+"/materials"),t==-1&&(url="/materials/group/materials"),e.view.materials=ajaxSendFn({count:10},url,"GET").result,e.view.leftIndex=t},e.sendGroup=function(){var t=ajaxSendFn({name:e.post.name},"/materials/group","POST");200===t.code?(e.view.checkName=!1,e.view.groups=ajaxSendFn({},"/materials/group","GET").result):alert(t.message)},e.pageChange=function(){url="/materials",e.view.leftIndex>=0&&(url="/materials/group/"+e.view.groups[e.view.leftIndex].id+"/materials"),e.view.leftIndex==-1&&(url="/materials/group/materials");var t={page:e.view.materials.page,count:e.view.materials.count};e.view.materials=ajaxSendFn(t,url,"GET").result},e.submitFn=function(){if(e.view.select>=0){var t=ajaxSendFn({id:e.view.materials.items[e.view.select].id},"/pic/shop","POST");200==t.code?(e.view.picurl.push(t.result),$("#addpic").modal("hide")):alert(t.message)}}}]),app.controller("ShopAdd2Ctr",["$scope","$location",function(e,t){e.gettable=ajaxSendFn({},"/tables","GET"),404e3!=e.gettable.code&&t.path("/shop/add2re"),e.view={table:[],box:[]},e.addtable=function(){e.tem={table:{}},$("#addtable").modal("show")},e.removeFn=function(t,a){e.view[t].splice(a,1)},e.reset=function(t){e.view.table[t].count<1&&(e.view.table[t].count=1)},e.addTbaleFn=function(){e.tem.table.seat&&e.tem.table.count&&(e.view.table.push(e.tem.table),$("#addtable").modal("hide"))},e.addBox=function(){e.tem={box:{seatNum:null,name:null,no:null,type:"1001"}},$("#addbox").modal("show")},e.addBoxFn=function(){e.tem.box.seatNum&&e.tem.box.name&&e.tem.box.no&&e.tem.box.seatNum>0&&(console.log(typeof e.tem.box.seatNum),e.view.box.push(e.tem.box),$("#addbox").modal("hide"))},e.sendposts=function(){var a=0;e.view.table.length>0&&(sendJson=angular.toJson(e.view.table),send1=ajaxSendFn(sendJson,"/tables","POST",1),200==send1.code&&a++),e.view.box.length>0&&(sendJson2=angular.toJson(e.view.box),send2=ajaxSendFn(sendJson2,"/tables/box","POST",1),200==send2.code&&a++),a>0&&t.path("/shop/add3")}}]),app.controller("ShopAdd3Ctr",["$scope","$location","$filter",function(e,t,a){for(e.shopshow={businesstime:ajaxSendFn({},"/businesstimes","GET").result},console.log(e.shopshow),e.posts=[{type:"1001",startTime:"",endTime:""},{type:"1002",startTime:"",endTime:""},{type:"1003",startTime:"",endTime:""},{type:"1004",startTime:"",endTime:""},{type:"1005",startTime:"",endTime:""}],e.tem={time:[],buname:["早市","午市","下午茶","晚市","宵夜"]},i=0;i<24;i++)e.tem.time.push(i+":00");e.sendposts=function(){var s=[];for(i=0;i<e.posts.length;i++)if(e.posts[i].startTime&&e.posts[i].endTime){if("1005"==e.posts[i].type){var o=a("date")(e.posts[i].startTime,"HH");if(o<18)return void alert("夜宵的开始时间不得早于0点")}e.posts[i].startTime.setFullYear(2e3),e.posts[i].endTime.setFullYear(2e3),e.posts[i].startTime=a("date")(e.posts[i].startTime,"yyyy-MM-dd HH:mm:ss"),e.posts[i].endTime=a("date")(e.posts[i].endTime,"yyyy-MM-dd HH:mm:ss"),s.push(e.posts[i])}sendJson=angular.toJson(s),sendre=ajaxSendFn(sendJson,"/businesstimes","POST",1),200==sendre.code?t.path("/shop/add4"):alert(sendre.message)}}]),app.controller("ShopAdd4Ctr",["$scope","$location","$filter",function(e,t,a){re=ajaxSendFn({},"/staffs/shop","GET").result||[],e.posts={staff:[]},e.sendok=re?re.items:[],e.addStaffFn=function(){e.posts.staff.push({code:"",name:"",tel:"",password:""})},console.log(e.sendok),e.sendok||e.addStaffFn(),e.removeStaffFn=function(t){e.posts.staff.splice(t,1)},e.sendposts=function(){for(var a=[],s=0;s<e.posts.staff.length;s++)json={},json.name=e.posts.staff[s].name,json.password=hex_md5(e.posts.staff[s].password),json.roleType="S",json.nickname=e.posts.staff[s].nickname,json.shopId=e.config.staff.shopId,re=ajaxSendFn(angular.toJson(json),"/staffs/staff","POST",1),200==re.code?(e.sendok.push(e.posts.staff[s]),a.push(s)):e.posts.staff[s].error="错误";a.sort();for(var o=a.length-1;o>=0;o--)e.posts.staff.splice(a[o],1);e.posts.staff.length<1&&e.sendok&&t.path("/shop/add5")}}]),app.controller("ShopAdd5Ctr",["$scope","$location","$filter",function(e,t,a){}]),app.controller("StaffShowCtr",["$scope","$location",function(e,t){e.user={},e.user.list={keeper:[],staffs:[]},e.config.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/staff",class:"staff"},{name:"员工列表"}],e.view={staffs:ajaxSendFn({},constUrlDict["staffs-shop"],"GET").result||{}},e.staffDelFn=function(t){return!!confirm("一旦删除将不可恢复，是否确认删除？")&&(staffDelRe=ajaxSendFn({},constUrlDict["staffs-base"]+"/"+e.view.staffs.items[t].id,"POST"),void(200==staffDelRe.code?e.view.staffs.items.splice(t,1):errorMsg(staffDelRe)))},e.pageChange=function(){var t={page:e.view.staffs.page,count:e.view.staffs.count};e.view.staffs=ajaxSendFn(t,constUrlDict["staffs-shop"],"GET").result}}]),app.controller("DutyCtr",["$scope","$location","$filter",function(e,t,a){e.config.breadset=[{name:"值班管理",href:indexUrl+"/keeper.html#/staff/duty",class:"duty"},{name:"值班日历列表"}];var s=new Date,o=s.getMonth(),n=s.getFullYear();json={startDate:a("date")(new Date(n,o,1),"yyyy-MM-dd"),endDate:a("date")(new Date(n,o+1,0),"yyyy-MM-dd")},e.view={templates:ajaxSendFn(json,"/duties/templates/usable","GET").result||{},staffs:ajaxSendFn(json,"/duties","GET").result||{},setting:ajaxSendFn({},"/duties/setting","GET").result||{}},e.post={},e.view.setting&&e.view.setting.templates?(e.post.date=new Date(e.view.setting.startDate),e.post.templates=e.view.setting.templates):e.post={templates:[{}]},e.closeDutyFn=function(){e.view.setting.enabled?"关闭此值班系统":"开启此值班系统";if(confirm("确定删除值班？")){var t=ajaxSendFn({},"/duties/setting","DELETE");200==t.code?e.post={}:alert(t.message)}},e.dutySwitch=function(){var t=e.view.setting.enabled?"关闭此值班系统":"开启此值班系统";if(confirm(t)){var a=ajaxSendFn({enabled:!e.view.setting.enabled},"/duties/state","POST");200==a.code?e.view.setting.enabled=!e.view.setting.enabled:alert(a.message)}},e.addFn=function(){e.post.templates.push({})},e.removeFn=function(t){e.post.templates.splice(t,1)},e.addTemplateFn=function(){var t={};t.startDate=a("date")(e.post.date,"yyyy-MM-dd"),t.enabled=!0,t.templates=[];for(var s in e.post.templates)t.templates.push({id:e.post.templates[s].id,sequence:s});var o=ajaxSendFn(t,"/duties/setting","POST");200==o.code?(alert("应用成功"),e.view.setting=ajaxSendFn({},"/duties/setting","GET").result,$("#selectTemplate").modal("hide")):alert(o.message)},e.redirectFn=function(e){e.target.dataset.date&&t.path("/staff/duty/"+e.target.dataset.date)},e.events=[];for(var r=1;r<32;r++){var i=!1,l="",d=o+1;for(var c in e.view.staffs)if(e.view.staffs[c].staffs.length&&e.view.staffs[c].date==a("date")(new Date(n+"-"+d+"-"+r),"yyyy-MM-dd")){i=!0;for(var u in e.view.staffs[c].staffs)l+=e.view.staffs[c].staffs[u].nickname+" "}e.events.push({title:l||"暂无排班",start:new Date(n+"-"+d+"-"+r),url:location.href+"/"+n+"-"+d+"-"+r,allDay:!0})}e.uiConfig={calendar:{height:450,editable:!1,header:{right:"",center:"title",left:"today prev,next"},viewRender:function(e,t){console.log("View Changed: ",e.visStart,e.visEnd,e.start,e.end)}}},e.eventSources=[e.events]}]),app.controller("DutyEditCtr",["$scope","$location","$routeParams","$filter",function(e,t,a,s){e.config.breadset=[{name:"值班管理",href:indexUrl+"/keeper.html#/staff/duty",class:"duty"},{name:"值班设置"}],e.view={staffs:ajaxSendFn({date:a.date},"/duties/staffs","GET").result||{},tables:{},type:{1001:"早市",1002:"午市",1003:"下午茶",1004:"晚市",1005:"夜宵"},date:a.date,text:[]},e.init=function(){e.view.tables=ajaxSendFn({date:a.date},"/duties/duty/day","GET").result||{}},e.init(),e.post={},e.posts={staffs:[{}]},e.addFn=function(){e.posts.staffs.push({})},e.removeFn=function(t){e.posts.staffs.splice(t,1)},e.openFn=function(t,a){if(e.posts={period:e.view.tables[t].periodDuties[a].period,regionId:e.view.tables[t].regionId},e.posts.staff=angular.copy(e.view.staffs),e.view.tables[t].periodDuties[a].staffs)for(var s in e.view.tables[t].periodDuties[a].staffs)for(var o in e.posts.staff)e.view.tables[t].periodDuties[a].staffs[s].id==e.posts.staff[o].id&&(e.posts.staff[o].check=!0);$("#staffSelect").modal("show")},e.submitFn=function(){var t=angular.copy(e.posts);t.staffs=[];for(var s in t.staff)t.staff[s].check&&t.staffs.push({id:t.staff[s].id});delete t.staff,t.date=a.date;var o=ajaxSendFn(t,"/duties/duty","POST");200==o.code?($("#staffSelect").modal("hide"),e.init()):alert(o.message)},e.deleteRegionFn=function(t){if(!confirm("一旦清空将不可恢复，是否确认清空？"))return!1;var s=ajaxSendFn({},"/duties/duty/day/"+a.date+"/region/"+t,"DELETE");200==s.code?e.init():alert(s.message)},e.deleteStaffFn=function(t,s){if(!confirm("一旦清空将不可恢复，是否确认清空？"))return!1;var o=ajaxSendFn({},"/duties/duty/day/"+a.date+"/region/"+t+"/period/"+s,"DELETE");200==o.code?e.init():alert(o.message)},e.deleteAllFn=function(){if(!confirm("一旦清空将不可恢复，是否确认清空？"))return!1;var t=ajaxSendFn({},"/duties/duty/day/"+a.date,"DELETE");200==t.code?e.init():alert(t.message)},e.tagSelectFn=function(t){e.view.text.push(s("date")(e.post.date,"yyyy-MM-dd"))},e.removeFn=function(t){e.view.text.splice(t,1)},e.submitDateFn=function(){var t=ajaxSendFn(e.view.text,"/duties/duty/day/"+a.date,"POST");200==t.code?(e.view.text=[],alert("操作成功")):alert(t.message)}}]),app.controller("TemplateDutyCtr",["$scope","$location","$routeParams","$filter",function(e,t,a,s){e.config.breadset=[{name:"值班管理",href:indexUrl+"/keeper.html#/staff/duty",class:"duty"},{name:"值班设置"}],e.view={staffs:ajaxSendFn({},"/duties/staffs","GET").result||{},tables:{},type:{1001:"早市",1002:"午市",1003:"下午茶",1004:"晚市",1005:"夜宵"}},e.post={},e.init=function(){e.view.tables=ajaxSendFn({},"/duties/templates","GET").result||{}},e.init(),e.post={},e.posts={staffs:[{}]},e.addFn=function(){e.posts.staffs.push({})},e.removeFn=function(t){e.posts.staffs.splice(t,1)},e.addTemplateFn=function(){var t=ajaxSendFn({name:e.post.name},"/duties/templates","POST");200==t.code?(e.init(),$("#addTemplate").modal("hide")):alert(t.message)},e.openFn=function(t,a,s){if(e.posts={period:e.view.tables[t].duties[a].periodDuties[s].period,regionId:e.view.tables[t].duties[a].regionId,id:e.view.tables[t].id},e.posts.staff=angular.copy(e.view.staffs),e.view.tables[t].duties[a].periodDuties[s].staffs)for(var o in e.view.tables[t].duties[a].periodDuties[s].staffs)for(var n in e.posts.staff)e.view.tables[t].duties[a].periodDuties[s].staffs[o].id==e.posts.staff[n].id&&(e.posts.staff[n].check=!0);$("#staffSelect").modal("show")},e.submitFn=function(){var t=angular.copy(e.posts);t.staffs=[];for(var a in t.staff)t.staff[a].check&&t.staffs.push({id:t.staff[a].id});delete t.staff;var s=t.id;delete t.id;var o=ajaxSendFn(t,"/duties/templates/"+s+"/duty","POST");200==o.code?($("#staffSelect").modal("hide"),e.init()):alert(o.message)},e.deleteRegionFn=function(t,a){if(!confirm("一旦清空将不可恢复，是否确认清空？"))return!1;var s=ajaxSendFn({},"/duties/templates/"+t+"/duty/region/"+a,"DELETE");200==s.code?e.init():alert(s.message)},e.deleteStaffFn=function(t,a,s){if(!confirm("一旦清空将不可恢复，是否确认清空？"))return!1;var o=ajaxSendFn({},"/duties/templates/"+t+"/duty/region/"+a+"/period/"+s,"DELETE");200==o.code?e.init():alert(o.message)},e.deleteAllFn=function(t){if(!confirm("一旦删除将不可恢复，是否确认删除？"))return!1;var a=ajaxSendFn({},"/duties/templates/"+t,"DELETE");200==a.code?e.init():alert(a.message)}}]),app.controller("ReserveDetailCtr",["$scope","$location","$routeParams","$filter",function(e,t,a,s){e.config.breadset=[{name:"预定管理",href:indexUrl+"/keeper.html#/table/reserve",class:"reserve"},{name:"预定设置"}],e.view={list:ajaxSendFn({},"/reserve/activity/"+a.aid,"GET").result||{},members:ajaxSendFn({},"/memberGrade","GET").result||[],tables:ajaxSendFn({},constUrlDict.tables,"GET").result||[]},e.view.members.push({id:"ALL",name:"全员"}),e.view.members.push({id:"MEMBER",name:"任一会员"}),e.openFn=function(t){t&&(e.post=ajaxSendFn({},"/reserve/"+t,"GET").result||{}),$("#addlist").modal("show")},e.submitFn=function(){var t=angular.copy(e.post);if(t.id){delete t.id;var s=ajaxSendFn(t,"/reserve/"+e.post.id,"PUT")}else var s=ajaxSendFn(t,"/reserve/"+a.aid,"POST");200==s.code?($("#addlist").modal("hide"),e.view.list=ajaxSendFn({},"/reserve/activity/"+a.aid,"GET").result||[]):alert(s.message)},e.removeFn=function(t){var s=confirm("确认删除？");if(s){var o=ajaxSendFn({},"/reserve/"+t,"DELETE");200==o.code?e.view.list=ajaxSendFn({},"/reserve/activity/"+a.aid,"GET").result||[]:alert(o.message)}}}]),app.controller("ReserveCtr",["$scope","$location","$routeParams","$filter",function(e,t,a,s){e.config.breadset=[{name:"预定管理",href:indexUrl+"/keeper.html#/table/reserve",class:"reserve"},{name:"预定设置"}],e.view={list:ajaxSendFn({},"/activity/reserve","GET").result||{}},e.pageChange=function(){var t={page:e.view.list.page,count:e.view.list.count};e.view.list=ajaxSendFn(t,"/activity/reserve","GET").result||{}}}]),app.controller("StaffeditCtr",["$scope","$location","$routeParams",function(e,t,a){e.show={},e.posts={},e.staffadd_form={},e.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/Staff"},{name:"编辑员工"}],e.posts=ajaxSendFn({},constUrlDict.staff+"/"+a.guestid,"GET").result,e.staffaddsend=function(){sendJson=JSON.stringify(e.posts),
result=ajaxSendFn(sendJson,constUrlDict.staff+"/"+a.guestid,"POST",1),200==result.code?(alert("修改成功"),t.path("/staff")):errorMsg(result)},e.imgUpload=function(t){return t.files[0].size>5242880?void alert("图片不得大于5M，图片格式为png,jpg,jpeg,bmp"):(POSTurl=basicUrl+"/staffs/staff/"+a.guestid+"/avatar?",options={url:POSTurl+sortUrl(),type:"POST",success:function(t){200===t.code?e.$apply(function(){e.posts=ajaxSendFn({},constUrlDict.staff+"/"+a.guestid,"GET").result}):alert(t.message)}},void $("#iimgform").ajaxSubmit(options))}}]),app.controller("Staffoperation",["$scope","$location","$routeParams",function(e,t,a){e.show={},e.posts={},e.staffadd_form={},e.breadset=[{name:"员工管理",href:indexUrl+"/admin.html#/Staff"},{name:"权限设置"}],e.password="",e.authorized=!1,e.show=!1,e.submit=!0,e.switch=!1,e.textCheckJson=textCheckJson,e.textCheckErrorJson=textCheckErrorJson,e.posts.gender=0,e.refund={authorized:!1,object:{}},e.pay={authorized:!1,object:{}},e.staff={authorized:!1,object:{}},e.activate={operations:"",object:{}},e.duty={authorized:!1,object:{}},e.activity={authorized:!1,object:{}},e.reserve={authorized:!1,object:{}},e.benefit={authorized:!1,operations:{},object:{}},e.customer={authorized:!1,operations:{},object:{}},e.check={authorized:!1,object:{}},e.profits={operations:{ADD:!1,UPDATE:!1},object:{8002:!1,8010:!1,8011:!1,8012:!1}},e.settime=function(t,a){"ADD"==a?e.customer.operations[t]=!e.customer.operations[t]||null:"STAGE"==a?e.check.object[t]=!e.check.object[t]||null:e.benefit.operations[t]=!e.benefit.operations[t]||null},e.settime2=function(t,a){"ADD"==a?e.customer.operations[t]=!e.customer.operations[t]||null:"STAGE"==a?e.check.object[t]=!e.check.object[t]||null:e.profits.operations[t]=!e.profits.operations[t]||null},e.grade=ajaxSendFn({},"/memberGrade","GET"),e.tables=ajaxSendFn({},"/tables","GET"),e.posts=ajaxSendFn({},"/staffs/staff/"+a.guestid+"/permission","GET"),200==e.posts.code&&(e.authorized=e.posts.result.authorized,e.posts.result.refund&&(e.refund.authorized=e.posts.result.refund.authorized,angular.forEach(e.posts.result.refund.objects,function(t,a){e.refund.object[t]=!0})),e.posts.result.activate&&(e.activate.authorized=e.posts.result.activate.authorized,angular.forEach(e.posts.result.activate.operations,function(t,a){e.activate.object[t]=!0})),e.posts.result.activity&&(e.activity.authorized=e.posts.result.activity.authorized,angular.forEach(e.posts.result.activity.objects,function(t,a){e.activity.object[t]=!0})),e.posts.result.pay&&angular.forEach(e.posts.result.pay.objects,function(t,a){e.pay.object[t]=!0}),e.posts.result.staff&&(e.staff.authorized=e.posts.result.staff.authorized,angular.forEach(e.posts.result.staff.operations,function(t,a){e.staff.object[t]=!0})),e.posts.result.duty&&(e.duty.authorized=e.posts.result.duty.authorized,angular.forEach(e.posts.result.duty.operations,function(t,a){e.duty.object[t]=!0})),e.posts.result.reserve&&(e.reserve.authorized=e.posts.result.reserve.authorized,angular.forEach(e.posts.result.reserve.operations,function(t,a){e.reserve.object[t]=!0})),e.posts.result.benefit&&(e.benefit.authorized=e.posts.result.benefit.authorized,angular.forEach(e.posts.result.benefit.operations,function(t,a){e.benefit.operations[t]=!0}),angular.forEach(e.posts.result.benefit.objects,function(t,a){e.benefit.object[t]=!0})),e.posts.result.profits&&(e.profits.authorized=e.posts.result.profits.authorized,angular.forEach(e.posts.result.profits.operations,function(t,a){e.profits.operations[t]=!0}),angular.forEach(e.posts.result.profits.objects,function(t,a){e.profits.object[t]=!0})),e.posts.result.benefit&&(e.customer.authorized=e.posts.result.customer.authorized,angular.forEach(e.posts.result.customer.operations,function(t,a){e.customer.operations[t]=!0}),angular.forEach(e.posts.result.customer.objects,function(t,a){e.customer.object[t]=!0})),e.posts.result.check&&angular.forEach(e.posts.result.check.objects,function(t,a){e.check.object[t]=!0})),e.changepassword=function(){e.switch=!e.switch,e.switch?document.getElementById("btn").innerText="取消修改":(document.getElementById("btn").innerText="修改密码",document.getElementById("newpass").value=e.password="")},e.checklength=function(){if(document.getElementById("setpass")){if(e.password=document.getElementById("setpass").value,e.password.length>0&&(e.password.length<8||e.password.length>20))return e.submit=!1,void alert("密码长度应为8-20个字符");e.submit=!0}else if(document.getElementById("newpass")&&e.switch){if(e.password=document.getElementById("newpass").value,e.password.length>0&&(e.password.length<8||e.password.length>20))return e.submit=!1,void alert("密码长度应为8-20个字符");e.submit=!0}console.log(e),console.log(e.password)},e.staffaddsend=function(t){var s={password:"",refund:{objects:[],authorized:""},pay:{objects:[],authorized:""},staff:{operations:[],authorized:""},activate:{operations:[],authorized:""},duty:{operations:[],authorized:""},activity:{objects:[],authorized:""},reserve:{operations:[],authorized:""},benefit:{operations:[],objects:[],authorized:""},customer:{operations:[],objects:[],authorized:""},check:{objects:[],authorized:""},profits:{operations:[],objects:[],authorized:""}};if(angular.forEach(e.refund.object,function(e,t){e&&s.refund.objects.push(t)}),e.refund.authorized&&(s.refund.authorized=e.refund.authorized),angular.forEach(e.pay.object,function(e,t){e&&s.pay.objects.push(t)}),angular.forEach(e.staff.object,function(e,t){e&&s.staff.operations.push(t)}),e.staff.authorized&&(s.staff.authorized=e.staff.authorized),angular.forEach(e.activate.object,function(e,t){e&&s.activate.operations.push(t)}),e.activate.authorized&&(s.activate.authorized=e.activate.authorized),angular.forEach(e.duty.object,function(e,t){e&&s.duty.operations.push(t)}),angular.forEach(e.activity.object,function(e,t){e&&s.activity.objects.push(t)}),e.activity.authorized&&(s.activity.authorized=e.activity.authorized),angular.forEach(e.reserve.object,function(e,t){e&&s.reserve.operations.push(t)}),e.reserve.authorized&&(s.reserve.authorized=e.reserve.authorized),angular.forEach(e.benefit.operations,function(e,t){e&&s.benefit.operations.push(t)}),e.benefit.authorized&&(s.benefit.authorized=e.benefit.authorized),angular.forEach(e.benefit.object,function(e,t){e&&s.benefit.objects.push(t)}),angular.forEach(e.customer.operations,function(e,t){e&&s.customer.operations.push(t)}),e.customer.authorized&&(s.customer.authorized=e.customer.authorized),e.customer.operations.ADD&&angular.forEach(e.customer.object,function(e,t){e&&s.customer.objects.push(t)}),angular.forEach(e.profits.operations,function(e,t){e&&s.profits.operations.push(t)}),e.profits.authorized&&(s.profits.authorized=e.profits.authorized),angular.forEach(e.profits.object,function(e,t){e&&s.profits.objects.push(t)}),angular.forEach(e.check.object,function(e,t){e&&s.check.objects.push(t)}),e.check.authorized&&(s.check.authorized=e.check.authorized),s.benefit.operations.length>=1&&s.benefit.objects.length<1)return void alert("请选择顾客权益类型");if(s.benefit.operations.length<1&&(console.log(s.benefit.operations),s.benefit.objects=[]),s.profits.operations.length>=1&&s.profits.objects.length<1)return void alert("请选择奖励类型");if(s.profits.operations.length<1&&(console.log(s.profits.operations),s.profits.objects=[]),e.customer.operations.ADD&&s.customer.objects.length<1)return void alert("请选择会员等级");if(s.refund.authorized=e.refund.authorized,s.activate.authorized=e.activate.authorized,s.pay.authorized=e.pay.authorized,s.check.authorized=e.check.authorized,s.customer.authorized=e.customer.authorized,s.benefit.authorized=e.benefit.authorized,s.profits.authorized=e.profits.authorized,s.duty.authorized=e.duty.authorized,s.activity.authorized=e.activity.authorized,s.reserve.authorized=e.reserve.authorized,!e.authorized||e.password)s.password=hex_md5(e.password);else{if(!e.authorized&&!e.password)return void alert("密码应由长度为8-20个字符");delete s.password}s=JSON.stringify(s),result=ajaxSendFn(s,"/staffs/staff/"+a.guestid+"/permission","POST",1),200==result.code?(alert("添加成功"),window.location.reload(!0)):errorMsg(result)}}]),app.controller("StaffaddCtr",["$scope","$location",function(e,t){e.config.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/staff"},{name:"添加员工"}],e.posts={},e.staffadd_form={submitted:!1},e.textCheckJson=textCheckJson,e.textCheckErrorJson=textCheckErrorJson,e.posts.gender=0,e.staffaddsend=function(a){var s={};angular.extend(s,e.posts),s.shopId=e.config.staff.shopId,s.roleType="keeper"==a?"K":"S",s.password=hex_md5(e.posts.password),s=JSON.stringify(s),result=ajaxSendFn(s,constUrlDict.staff,"POST",1),200==result.code?(alert("添加成功"),t.path("/staff")):errorMsg(result)}}]),app.controller("ShopBusinesstimeCtr",["$scope","$filter","$location",function(e,t,a){e.view={table:{1001:{type:"1001",startTime:"",endTime:"",show:0,buname:"早市"},1002:{type:"1002",startTime:"",endTime:"",show:0,buname:"午市"},1003:{type:"1003",startTime:"",endTime:"",show:0,buname:"下午茶"},1004:{type:"1004",startTime:"",endTime:"",show:0,buname:"晚市"},1005:{type:"1005",startTime:"",endTime:"",show:0,buname:"宵夜"}}},e.getTimeFn=function(){for(e.view.businesstime=ajaxSendFn({},constUrlDict.businesstimes,"GET").result,i=0;e.view.businesstime&&i<e.view.businesstime.length;i++)key=e.view.businesstime[i].type,name=e.view.table[e.view.businesstime[i].type].buname,e.view.table[key]=e.view.businesstime[i],e.view.table[key].show=1,e.view.table[key].buname=name,e.view.table[key].startTime=new Date(Date.parse("2000-01-01 "+e.view.table[key].startTime.replace(/-/g,"/"))),e.view.table[key].endTime=new Date(Date.parse("2000-01-01 "+e.view.table[key].endTime.replace(/-/g,"/")))},e.getTimeFn(),e.addFn=function(t){e.view.table[t].show=1},e.saveFn=function(){var s=[];for(var o in e.view.table)if(e.view.table[o].startTime&&e.view.table[o].endTime){var n={};if(e.view.table[o].startTime.setFullYear(2e3),e.view.table[o].endTime.setFullYear(2e3),n.startTime=e.view.table[o].startTime,n.type=e.view.table[o].type,n.endTime=e.view.table[o].endTime,n.endTime=t("date")(n.endTime,"yyyy-MM-dd HH:mm:ss"),n.startTime=t("date")(n.startTime,"yyyy-MM-dd HH:mm:ss"),e.view.table[o].id&&(n.id=e.view.table[o].id),"1005"==n.type){var r=t("date")(e.view.table[o].startTime,"HH");if(r<18)return void alert("夜宵的开始时间不得早于0点")}s.push(n)}sendJson=JSON.stringify(s),result=ajaxSendFn(sendJson,constUrlDict.businesstimes,"POST",1),200!=result.code?errorMsg(result):(e.getTimeFn(),a.path("/shop"))},e.delFn=function(t){return e.view.table[t].id&&(result=ajaxSendFn({},constUrlDict.businesstimes+"/"+e.view.table[t].id,"POST"),200!=result.code)?void console.error(result):void(e.view.table[t]={type:t,startTime:"",endTime:"",show:0,buname:e.view.table[t].buname})}}]),app.controller("TablesCtr",["$scope","$filter",function(e,t){e.config.breadset=[{name:"桌台管理",href:indexUrl+"/keeper.html#/table/tables",class:"tables"},{name:"查看桌台"}];var a={};e.download={},e.view={tables:[],boxs:[]},e.view.regions=ajaxSendFn({},"/regions/names","GET").result||[],undoAction=function(){var t="1001"===a.type?e.view.tables:e.view.boxs;for(i=0,l=t.length;i<l;i++)a.id===t[i].id&&(t[i].seatNum=a.seatNum,t[i].no=a.no,t[i].name=a.name)},makeAction=function(t,a,s,o,n){return function(){var a=angular.copy(e.post);delete a.$$hashKey,delete a.show,delete a.url,delete a.urlWithLogo,"1001"===a.type&&delete a.name,a.seatNum=parseInt(a.seatNum),a.regionId||delete a.regionId,result=ajaxSendFn(a,t(e.post),s,1),200!=result.code?(errorMsg(result),n&&undoAction()):e.getTables(),$("#addtable").modal("hide")}},e.actionhandle={add:makeAction(function(e){return constUrlDict["tables-table"]},function(e){return[e]},"POST",function(t,a){"1001"==a.type?e.view.tables.push(a):e.view.boxs.push(a)},!1),edit:makeAction(function(e){return e.id?constUrlDict["tables-table"]+"/"+e.id:void alert("暂时无法编辑，请刷新后重试")},null,"POST",function(){alert("修改成功")},!0)},e.getTables=function(){if(gettables=ajaxSendFn({},constUrlDict.tables,"GET").result,e.gettables=gettables,gettables){e.view.tables=[],e.view.boxs=[];for(var t=0;t<gettables.length;t++)1001==gettables[t].type?e.view.tables.push(gettables[t]):e.view.boxs.push(gettables[t])}},e.tem={},e.modaladd=function(t){e.post={},e.view.action="add","table"==t?(e.post.type="1001",e.view.modalname="添加散台",e.tem.nameshow=0):(e.post.type="1002",e.view.modalname="添加包厢",e.tem.nameshow=1),$("#addtable").modal("show")},e.dispatchAction=function(){e.actionhandle[e.view.action]()},e.cancelAction=function(){undoAction()},e.tableDelFn=function(t,a){del=ajaxSendFn({},constUrlDict.tables+"/"+t.id,"POST"),200!=del.code?errorMsg(del):"1001"===t.type?e.view.tables.splice(a,1):e.view.boxs.splice(a,1)},e.editTableFn=function(t,s){e.post=e.view[t][s],angular.extend(a,e.post),e.view.action="edit","tables"==t?(e.view.modalname="修改散台",e.tem.nameshow=0):(e.view.modalname="修改包厢",e.tem.nameshow=1),$("#addtable").modal("show")},e.getTables(),e.sendposts=function(){var t=0;e.view.table.length>0&&(sendJson=angular.toJson(e.view.table),send1=ajaxSendFn(sendJson,"/tables","POST",1),200==send1.code&&t++),e.view.box.length>0&&(sendJson2=angular.toJson(e.view.box),send2=ajaxSendFn(sendJson2,"/tables/box","POST",1),200==send2.code&&t++),t>0&&$location.path("/shop/add3")},e.downloadFn=function(t){"download"==t||"delete"==t?(e.view.state=t,delete e.download.id):e.download.id=t,$("#generate").modal("show")},e.open=function(e){var t=ajaxSendFn({type:"101"},"/tables/qrcode/"+e,"GET");window.open(t.result.url,"_blank")},e.generate=function(){var t={type:"102"};if(e.download.type&&(t.type=e.download.type),e.download.id){var a=ajaxSendFn(t,"/tables/qrcode/"+e.download.id,"GET"),s=document.createElement("a");s.setAttribute("href",a.result.url),s.setAttribute("download","");var o=document.createEvent("MouseEvents");return o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!0,!1,0,null),s.dispatchEvent(o),void $("#generate").modal("hide")}var n;n="download"==e.view.state?ajaxSendFn(t,"/tables/qrcode","GET"):ajaxSendFn({},"/tables/file/"+t.type,"DELETE"),$("#generate").modal("hide"),n.result&&(location.href=n.result),e.result=!0},e.getZip=function(){window.open("/tables/download/"+e.download.type,"_blank")}}]),app.controller("RegionsCtr",["$scope","$filter",function(e,t){e.config.breadset=[{name:"桌台管理",href:indexUrl+"/keeper.html#/table/regions",class:"regions"},{name:"查看分区"}],e.view={},e.view.regions=ajaxSendFn({},"/regions","GET").result||[],e.submitFn=function(){var t=ajaxSendFn(e.post,"/regions","POST");200==t.code&&($("#addRegions").modal("hide"),e.view.regions=ajaxSendFn({},"/regions","GET").result||[])},e.regionDelFn=function(t){if(!confirm("一旦删除将不可恢复，是否确认删除？"))return!1;var a=ajaxSendFn({},"/regions/"+e.view.regions.items[t].id,"DELETE");200==a.code?e.view.regions.items.splice(t,1):alert(a.message)}}]),app.controller("RegionDetailCtr",["$scope","$filter","$routeParams",function(e,t,a){e.config.breadset=[{name:"桌台管理",href:indexUrl+"/keeper.html#/table/regionDetail",class:"regions"},{name:"查看分区"}],e.view={},e.download={},e.view.regions=ajaxSendFn({},"/regions/"+a.id,"GET").result||[],e.view.region=ajaxSendFn({},"/regions/names","GET").result||[],e.submitFn=function(){var t=ajaxSendFn(e.post,"/regions","POST");200==t.code&&($("#addRegions").modal("hide"),e.view.regions=ajaxSendFn({},"/regions","GET").result||[])},e.downloadFn=function(t){t?e.download.id=t:delete e.download.id,$("#generate").modal("show")},e.generate=function(){var t={type:"102"};if(e.download.type&&(t.type=e.download.type),e.download.id){var a=ajaxSendFn(t,"/tables/qrcode/"+e.download.id,"GET"),s=document.createElement("a");s.setAttribute("href",a.result.url),s.setAttribute("download","");var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!0,!1,0,null),s.dispatchEvent(o),$("#generate").modal("hide")}},e.getZip=function(){window.open("/tables/download/"+e.download.type,"_blank")},e.editTableFn=function(t){e.post=void 0!==t?e.view.regions.tables[t]:{},$("#addtable").modal("show")},e.deleteRegionTable=function(t){var s=ajaxSendFn({},"/regions/"+a.id+"/tables/"+e.view.regions.tables[t].id,"DELETE");200==s.code?e.view.regions.tables.splice(t,1):alert(s.message)},e.dispatchAction=function(){return e.post.type?(e.post.regionId||delete e.post.regionId,"1001"==e.post.type&&delete e.post.name,send1=ajaxSendFn(e.post,"/tables/table","POST",1),void(200==send1.code?($("#addtable").modal("hide"),e.view.regions=ajaxSendFn({},"/regions/"+a.id,"GET").result||[]):alert(send1.message))):void alert("请先选择类型")},e.regionSelectFn=function(){var t=ajaxSendFn({},"/tables/regions","GET");200==t.code?(e.view.defalutRegion=t.result,$("#regionSelect").modal("show")):alert("没有可供选择的桌台了")},e.regionSelectSubmitFn=function(){var t=[];for(var s in e.view.defalutRegion)e.view.defalutRegion[s].check&&t.push(e.view.defalutRegion[s].id);if(0==t.length)return void $("#regionSelect").modal("hide");var o=ajaxSendFn(t,"/regions/"+a.id+"/tables","POST");200==o.code?(e.view.regions=ajaxSendFn({},"/regions/"+a.id,"GET").result||[],$("#regionSelect").modal("hide")):alert(o.message)}}]),app.controller("CommentCtr",["$scope",function(e){e.config.breadset=[{name:"活动",href:indexUrl+"/keeper.html#/rule"},{name:"顾客评论"}];var t=ajaxSendFn({},"/comments/shop","GET").result;t&&(e.view={comment:t.items||[]},e.view.satisfaction={1001:"很棒",1002:"一般",1003:"较差"})}]),app.controller("CustomerCtr",["$scope","tyFnFactory","$http","$location","$filter","$routeParams",function(e,t,a,s,o,n){if(e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer",class:"customer"},{name:"顾客列表"}],e.view={index:[],sort:{1000:"最近消费",1010:"消费额度",1020:"消费次数",1030:"加入时间",1040:"会员等级",1050:"用户积分",1060:"充值余额",1070:"券张数"}},n.userId){e.search={param:n.userId};var r=ajaxSendFn({param:n.userId},"/customer/search","GET").result;e.view.customer={items:r||[],page:1,total:r.length}}else e.view.customer=ajaxSendFn({},"/customer","GET").result||[];e.view.memberGrades=ajaxSendFn({},constUrlDict.memberGrade,"GET").result||[],e.view.member=[],e.search={},e.post={genders:[],memberGradeIds:[]},e.tag={name:"",user:[]},e.postSend=function(){e.search.param?(e.view.customer.total=0,e.view.customer.items=ajaxSendFn(e.search,"/customer/search","GET").result||[]):e.view.customer=ajaxSendFn({},"/customer","GET").result||[]},e.refer=function(e){window.open("keeper.html#/"+e,"_blank")},e.searchFn=function(t){var a=angular.copy(e.post);"9001"!=a.type&&delete a.memberGradeIds;for(var s in a){if("memberGradeIds"==s){for(var n="",r=0;r<a.memberGradeIds.length;r++)a.memberGradeIds[r]&&(n=n+a.memberGradeIds[r]+",");n?a.memberGradeIds=n.substr(0,n.length-1):delete a.memberGradeIds}if("genders"==s){var n="";a.genders[0]&&(n=a.genders[0]+","),a.genders[1]&&(n+=a.genders[1]+","),a.genders[2]&&(n+=a.genders[2]+","),n?a.genders=n.substr(0,n.length-1):delete a.genders}a[s]instanceof Date&&(a[s]=o("date")(a[s],"yyyy-MM-dd")),a[s]||"number"==typeof a[s]||delete a[s]}t&&(a.page=t),e.view.customer=ajaxSendFn(a,"/customer","GET").result||[]},e.pageChange=function(){e.searchFn(e.view.customer.page)}}]),app.controller("CustomerTagCtr",["$scope","tyFnFactory","$http","$location","$filter",function(e,t,a,s,o){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer",class:"tag"},{name:"顾客列表"}],e.view={tag:ajaxSendFn({},"/tags","GET").result||[]},e.search={},e.tag={name:"",user:[]},e.postSend=function(){window.open("keeper.html#/customer/"+e.search.param,"_blank")},e.detailFn=function(t){e.view.index=t,e.view.id=e.view.tag.items[t].id,e.view.detail=ajaxSendFn({},"/tags/"+e.view.tag.items[t].id,"GET").result||[]},e.pageChange=function(){var t={page:e.view.tag.page,count:e.view.tag.count};e.view.tag=ajaxSendFn(t,"/tags","GET").result||[]},e.pageUserChange=function(){var t={page:e.view.detail.page,count:e.view.detail.count};e.view.detail=ajaxSendFn(t,"/tags/"+e.view.tag.items[e.view.index].id,"GET").result||[],e.tag.user=[]}}]),app.controller("CustomerDetailsCtr",["$scope","$routeParams",function($scope,$routeParams){var userId=$routeParams.userId;$scope.view={user:ajaxSendFn({},"/customer/"+$routeParams.userId,"GET").result||[],type:{consume:"/consume",charge:"/charge",point:"/point",reward:"/reward",coupon:"/coupon"}},$scope.view.charts={title:{text:""},options:{credits:{enabled:!1},chart:{type:"line"},tooltip:{},xAxis:{},yAxis:{}},series:[]},$scope.consumeFn=function(e){if($scope.view.tab="consume",$scope.view.consume=ajaxSendFn({page:e||1},"/benefit/"+$routeParams.userId+$scope.view.type[$scope.view.tab],"GET").result||[],0!=$scope.view.consume.length){for(var t=[],a=[],s=[],o=$scope.view.consume.items.length-1;o>=0;o--)t.push($scope.view.consume.items[o].consumptionTime),a.push($scope.view.consume.items[o].amount),s.push($scope.view.consume.items[o].revenue);$scope.view.charts.title.text="顾客近20笔消费记录",$scope.view.charts.options.xAxis={title:{text:"日期"},labels:{formatter:function(){return formatDate(this.value,"MM-dd HH:mm:ss")}},categories:t},$scope.view.charts.options.yAxis={title:{text:"金额"},labels:{formatter:function(){return this.value}}},$scope.view.charts.series=[{name:"原价",color:"#FF9655",data:a,step:"left"},{name:"实付",color:"red",data:s,step:"left"}]}},$scope.chargeFn=function(e){if($scope.view.tab="charge",$scope.view.charge=ajaxSendFn({page:e||1},"/benefit/"+$routeParams.userId+$scope.view.type[$scope.view.tab],"GET").result||[],0!=$scope.view.charge.length){for(var t=[],a=[],s=[],o=$scope.view.charge.items.length-1;o>=0;o--)t.push($scope.view.charge.items[o].time),"601"==$scope.view.charge.items[o].type?(a.push($scope.view.charge.items[o].amount-0),s.push(null)):(a.push(null),s.push($scope.view.charge.items[o].amount-0));$scope.view.charts.title.text="顾客近20笔充值记录",$scope.view.charts.options.xAxis={title:{text:"充值日期"},labels:{},categories:t},$scope.view.charts.options.yAxis={title:{text:"充值金额"},labels:{formatter:function(){return this.value}}},$scope.view.charts.series=[{name:"获得",color:"#FF9655",data:a},{name:"使用",color:"red",data:s}]}},$scope.rewardFn=function(e){if($scope.view.tab="reward",$scope.view.reward=ajaxSendFn({page:e||1},"/benefit/"+$routeParams.userId+$scope.view.type[$scope.view.tab],"GET").result||[],0!=$scope.view.reward.length){for(var t=[],a=[],s=[],o=$scope.view.reward.items.length-1;o>=0;o--)t.push($scope.view.reward.items[o].time),"601"==$scope.view.reward.items[o].type?(a.push($scope.view.reward.items[o].amount-0),s.push(null)):(a.push(null),s.push($scope.view.reward.items[o].amount-0));$scope.view.charts.title.text="顾客近20笔代用币记录",$scope.view.charts.options.xAxis={title:{text:"日期"},labels:{},categories:t},$scope.view.charts.options.yAxis={title:{text:"金额"},labels:{formatter:function(){return this.value}}},$scope.view.charts.series=[{name:"获得",color:"#FF9655",data:a},{name:"使用",color:"red",data:s}]}},$scope.pointFn=function(e){if($scope.view.tab="point",$scope.view.point=ajaxSendFn({page:e||1},"/benefit/"+$routeParams.userId+$scope.view.type[$scope.view.tab],"GET").result||[],0!=$scope.view.point.length){for(var t=[],a=[],s=[],o=$scope.view.point.items.length-1;o>=0;o--)t.push($scope.view.point.items[o].time),"601"==$scope.view.point.items[o].type?(a.push($scope.view.point.items[o].amount-0),s.push(null)):(a.push(null),s.push($scope.view.point.items[o].amount-0));$scope.view.charts.title.text="顾客近20笔积分记录",$scope.view.charts.options.xAxis={title:{text:"日期"},labels:{formatter:function(){return formatDate(this.value,"MM-dd HH:mm:ss")}},categories:t},$scope.view.charts.options.yAxis={title:{text:"数量"},labels:{formatter:function(){return this.value}}},$scope.view.charts.series=[{name:"获得",color:"#FF9655",data:a,step:"left"},{name:"使用",color:"red",data:s,step:"left"}]}},$scope.consumeFn(),$scope.couponFn=function(e){$scope.view.tab="coupon",$scope.view.coupon=ajaxSendFn({page:e||1},"/benefit/"+$routeParams.userId+$scope.view.type[$scope.view.tab],"GET").result||[]},$scope.pageChange=function(){eval("$scope."+$scope.view.tab+"Fn("+$scope.view[$scope.view.tab].page+")")}}]),app.controller("CustomerChargeCtr",["$scope","$routeParams","$filter","$http",function(e,t,a,s){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客充值"}],e.view={},e.posts={type:"PUT"},e.reason={PUT:"使用",POST:"充值"},e.view.user=ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[],e.send=function(){var a={};a.userId=t.userId,a.amount=e.posts.amount,reason=e.reason[e.posts.type],"PUT"==e.posts.type?re=ajaxSendFn(JSON.stringify(a),"/benefit/charge/use","POST",1):re=ajaxSendFn(JSON.stringify(a),"/benefit/charge","POST",1),200==re.code?(e.view.user=ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[],e.posts.amount=0,alert(reason+"成功")):alert(datda.message)}}]),app.controller("CustomerPointCtr",["$scope","$routeParams",function(e,t){e.view={user:ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[]},e.posts={type:"PUT"},e.reason={PUT:"使用",POST:"发放"},e.send=function(){var a={};a.userId=t.userId,a.amount=e.posts.amount,reason=e.reason[e.posts.type],"PUT"==e.posts.type?re=ajaxSendFn(JSON.stringify(a),"/benefit/point/use","POST",1):re=ajaxSendFn(JSON.stringify(a),"/benefit/point","POST",1),200==re.code?(e.view.user=ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[],e.posts.amount=0,alert(reason+"成功")):errorMsg(re)}}]),app.controller("CustomerCouponCtr",["$scope","$routeParams",function(e,t){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客发券"}],e.view={user:ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[]},e.posts={},e.view.coupons=ajaxSendFn({},constUrlDict.coupon,"GET").result||[],e.view.coupons.length>0&&(e.posts.coupons=[{id:e.view.coupons[0].id,count:1}]),e.add=function(){e.view.coupons.length>0&&(e.posts.coupons.push({id:e.view.coupons[0].id,count:1}),console.log(e.posts.coupons))},e.remove=function(t){e.posts.coupons.splice(t,1)},e.canSend=function(){return e.view.coupons&&e.view.coupons.length>0},e.send=function(){if(json={},json.userId=t.userId,e.posts.coupons&&e.posts.coupons.length>0){json.coupons=e.posts.coupons;for(var a in json.coupons)delete json.coupons[a].$$hashKey;re=ajaxSendFn(JSON.stringify(json),"/benefit/coupon","POST",1),200==re.code?alert("赠券成功"):errorMsg(re)}}}]),app.controller("CustomerUpgradeCtr",["$scope","$routeParams","$filter","$http",function(e,t,a,s){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客升级"}],e.view={member:ajaxSendFn({},"/memberGrade","GET").result||[]},e.posts={},e.view.user=ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[],e.send=function(){var a={};a.userId=t.userId,a.memberGradeId=e.posts.memberGradeId,re=ajaxSendFn(JSON.stringify(a),"/benefit/upgrade","POST",1),200==re.code?(e.view.user=ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[],alert("升级成功")):alert(re.message)}}]),app.controller("CustomerAddCtr",["$interval","$scope","$location","$filter",function(e,t,a,s){t.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"添加会员"}],t.view={member:ajaxSendFn({},"/memberGrade","GET").result||[],repeats:90},t.posts={birthday:""},t.getValidateCode=function(e){t.posts.phone&&(re=ajaxSendFn({phone:t.posts.phone},"/customer/validate","POST"),200==re.code?console.log("验证码发送成功"):alert(re.message))},t.send=function(){t.posts.birthday=s("date")(t.posts.birthday,"yyyy-MM-dd"),re=ajaxSendFn(t.posts,"/customer","POST"),200==re.code?(alert("添加成功"),a.path("/customer")):errorMsg(re)}}]),app.controller("RuleCtr",["$scope","$location","$filter","$document","$compile","$rootScope",function(e,t,a,s,o,n){e.config.breadset=[{name:"活动管理",href:indexUrl+"/keeper.html#/rule",class:"rule"},{name:"活动列表"}],rule=ajaxSendFn({},"/activity","GET").result||[];var r=ajaxSendFn({isConsume:!0},"/activity","GET").result||[];rule=r.concat(rule),e.view={},e.view.rule=a("orderBy")(rule,"createTime",!0),e.copyFn=function(e){var t=angular.element('<span id="ngClipboardCopyId">'+e+"</span>"),a=s.find("body").eq(0);a.append(o(t)(n));var r=angular.element(document.getElementById("ngClipboardCopyId")),i=document.createRange();i.selectNode(r[0]),window.getSelection().removeAllRanges(),window.getSelection().addRange(i);var l=document.execCommand("copy"),d=l?"成功":"失败";alert("复制"+d),window.getSelection().removeAllRanges(),t.remove()}}]),app.controller("RuleCouponCtr",["$scope","$http","CouponFactory",function(e,t,a){e.config.breadset=[{name:"活动管理",href:indexUrl+"/keeper.html#/rule",class:"coupon"},{name:"券管理"}],e.view={coupons:ajaxSendFn({},"/coupon","GET").result||[],type:{901:"代金券",902:"实物券",9021:"套餐券",903:"折扣券",904:"礼品券",9011:"抵扣券",9031:"品类折扣券"},state:{4001:"未使用",4002:"已核销",4003:"过期"}},e.detailFn=function(t){e.coupon=ajaxSendFn({},"/coupon/"+t,"GET").result,$("#show").modal("show")},e.pageChange=function(){var t={page:e.view.coupons.page,count:e.view.coupons.count};e.view.coupons=ajaxSendFn(t,"/coupon","GET").result||[]}}]),app.controller("RuleRewardCtr",["$scope","$http","CouponFactory",function(e,t,a){e.config.breadset=[{name:"活动管理",href:indexUrl+"/keeper.html#/rule",class:"reward"},{name:"代用币管理"}],e.view={reward:ajaxSendFn({},"/reward","GET").result||[]},e.pageChange=function(){var t={page:e.view.reward.page,count:e.view.reward.count};e.view.reward=ajaxSendFn(t,"/reward","GET").result||[]}}]),app.controller("RuleMemberCtr",["$scope","$filter",function(e,t){e.config.breadset=[{name:"活动管理",href:indexUrl+"/keeper.html#/rule",class:"member"},{name:"会员规则管理"}];var a=ajaxSendFn({},"/memberUpgrade","GET").result||[];e.view={member:t("orderBy")(a.strategy,"grade",!1)||[],state:a.on}}]),app.controller("passwordCtr",["$scope","$location","$routeParams",function(e,t,a){e.posts={},e.staffadd_form={},e.config.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/Staff"},{name:"重设密码"}],e.staffget=ajaxSendFn({},constUrlDict.staff+"/"+a.guestid,"GET").result,e.textCheckJson=textCheckJson,e.textCheckErrorJson=textCheckErrorJson,e.staffadd_form.submitted=!1,e.staffget.shopname=ajaxSendFn({},"/shops/shop","GET").result.name,e.staffaddsend=function(){if(e.staffadd_form.$valid){var a={};angular.extend(a,e.posts),a.password=hex_md5(e.posts.password),result=ajaxSendFn(a,constUrlDict["staffs-password"]+"/"+e.staffget.id,"POST"),200==result.code?(alert("修改成功"),t.path("/staff")):errorMsg(result)}else e.staffadd_form.submitted=!0}}]),app.controller("edit_passwordCtr",["$scope","$location",function(e,t){e.show={},e.posts={},e.staffadd_form={},e.config.breadset=[{name:"修改密码"}],e.staffaddsend=function(){if(!e.staffadd_form.$valid)return void(e.staffadd_form.submitted=!0);if(e.posts.oldPassword===e.posts.password)return void alert("原密码和新密码不能相同");var a={};a.old=hex_md5(e.posts.oldPassword),a.password=hex_md5(e.posts.password),result=ajaxSendFn(a,constUrlDict["staffs-password"],"POST"),200==result.code?(alert("修改成功"),t.path("/")):4102==result.code?alert("原密码不匹配，请重试"):errorMsg(result)}}]),app.controller("DevicesCtr",["$scope","$http","deviceFactory",function(e,t,a){e.config.breadset=[{name:"设备管理",href:indexUrl+"/keeper.html#/devices"},{name:"设备列表"}],e.search={count:20},e.getDevices=function(){e.view={devices:a.getAllDevices(e.search)}},e.jihuo=function(){a.jihuo(function(t){e.getDevices()})},e.pageChange=function(){e.search.page=e.view.devices.page,e.getDevices()},e.unbind=function(t){var a=ajaxSendFn({},"/activate/"+e.view.devices.items[t].id,"POST");200==a.code?(alert("解绑成功！"),e.getDevices()):alert(a.message)},e.getDevices()}]),app.controller("BuyCtr",["$scope","$location","$http","$filter",function(e,t,a,s){e.config.breadset=[{name:"商城管理",href:indexUrl+"/keeper.html#/mall/buy",class:"buy"},{name:"购买列表"}],e.obtainRepeatCategory=obtainRepeatCategory,e.view={mall:ajaxSendFn({},"/mall","GET").result||{}},e.view.member=ajaxSendFn({},"/memberGrade","GET").result||[],e.view.member=s("orderBy")(e.view.member,"grade"),e.view.member=[{id:"ALL",name:"全员"},{id:"CUSTOMER",name:"非会员"},{id:"MEMBER",name:"任一会员"}].concat(e.view.member),e.detailFn=function(t){e.view.detail=e.view.mall.items[t],e.view.detail.text=[];for(var a in e.view.detail.detail){var s=e.view.detail.detail[a];for(var o in e.view.member)if(a==e.view.member[o].id){
e.view.detail.text.push(e.view.member[o].name+"可花费"+s+"元购买");break}}$("#show").modal("show")},e.turnFn=function(t,a){data=ajaxSendFn({},"/mall/"+e.view.mall.items[t].id+"/"+a,"POST"),200==data.code?e.view.mall.items[t].on=!e.view.mall.items[t].on:alert(data.message)},e.deleteFn=function(t){return!!confirm("一旦删除将不可恢复，是否确认删除？")&&(data=ajaxSendFn({},"/mall/"+e.view.mall.items[t].id,"DELETE"),void(200==data.code?e.view.mall.items.splice(t,1):alert(data.message)))},e.pageChange=function(){var t={page:e.view.mall.page,count:view.mall.count};e.view.mall=ajaxSendFn(t,"/mall","GET").result||[]}}]),app.controller("DishCtr",["$scope","$location","$http",function(e,t,a){e.config.breadset=[{name:"菜品管理",href:indexUrl+"/keeper.html#/mall/dish",class:"dish"},{name:"菜品列表"}];var s=ajaxSendFn({},"/dishes","GET");e.view={groups:ajaxSendFn({},"/dishes/categories","GET").result||[],leftIndex:-2},e.dishes={list:s.result},e.groupList=function(t){var a={};t>=0&&(a.categoryId=e.view.groups[t].id),e.dishes.list=ajaxSendFn(a,"/dishes","GET").result,e.view.leftIndex=t},e.pageChange=function(){e.view.leftIndex>=0&&(t.categoryId=e.view.groups[e.view.leftIndex].id);var t={page:e.dishes.page,count:e.dishes.count};e.dishes=ajaxSendFn(t,"/dishes","GET").result||[]}}]),app.controller("MealCtr",["$scope","$location","$http",function(e,t,a){e.config.breadset=[{name:"套餐管理",href:indexUrl+"/keeper.html#/mall/meal",class:"meal"},{name:"套餐列表"}];var s=ajaxSendFn({},"/meals","GET");e.view=s.result,e.detailFn=function(t){e.meal=e.view.items[t],$("#show").modal("show")},e.pageChange=function(){var t={page:e.view.page,count:e.view.count};e.view=ajaxSendFn(t,"/meals","GET").result||[]}}]),app.controller("CategoryCtr",["$scope","$location","$http",function(e,t,a){e.config.breadset=[{name:"品类管理",href:indexUrl+"/keeper.html#/mall/category",class:"category"},{name:"品类管理"}],e.view={list:ajaxSendFn({},"/dishes/categories","GET").result||""}}]),app.controller("DocCtr",["$rootScope","$scope","$location","shopFactory",function(e,t,a,s){t.config.breadset=[],t.config.class="doc",t.posts={shopId:"brand"},t.view={buttons:["惠买单消费报表","快速收款报表","充值报表","会员升级报表","打赏购买","砍价购买","抽奖购买","商城购买","积分报表","优惠券报表","代用币报表","短信使用报表","服务员收益","营销支出","探店储值卡"],coupons:ajaxSendFn({},"/reports/coupon/coupons","GET").result||[],staffs:ajaxSendFn({},"/reports/profits/staffs/shop","GET").result||[],business:[{id:"8001",name:"费率分成"},{id:"8002",name:"打赏小红花"},{id:"8003",name:"用户分销赏金"},{id:"8004",name:"用户分销佣金"}],card:ajaxSendFn({},"/reports/card/cards","GET").result||[]},t.sendOrder=function(){a.path("/doc/detail/"+t.posts.order)}}]),app.controller("FinanceCtr",["$rootScope","$scope","$filter",function(e,t,a){t.config.class="finance",t.view={projects:{901:"消费",902:"充值",904:"升级",909:"收款",907:"打赏"}},t.posts={},t.initTimeFn=function(){var e=new Date;e.setHours(23),e.setMinutes(59),e.setSeconds(59),t.posts.endTime=e;var s=new Date;s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setDate(e.getDate()-30),t.posts.startTime=s,t.view.initTime=a("date")(new Date,"yyyy-MM-dd")+"T59:59"},t.initTimeFn(),t.searchFn=function(){if((t.posts.endTime-t.posts.startTime)/864e5>31)return void alert("起止时间不能超过31天");var e={};e.startTime=a("date")(t.posts.startTime,"yyyy-MM-dd HH:mm:ss"),e.endTime=a("date")(t.posts.endTime,"yyyy-MM-dd HH:mm:ss");var s=ajaxSendFn(e,"/finance/shop","GET"),o=ajaxSendFn(e,"/finance/day","GET");(s.code=200)?t.view.result=s.result||[]:alert(s.message),(o.code=200)?t.view.result1=o.result||[]:alert(s.message)},t.detailFn=function(e,s,o){var n={};n.startTime=a("date")(t.posts.startTime,"yyyy-MM-dd HH:mm:ss"),n.endTime=a("date")(t.posts.endTime,"yyyy-MM-dd HH:mm:ss"),o&&(n.reason=o),s&&(n.channel=s);var r="";for(var i in n)r+=i+"="+n[i]+"&";r=r.substring(0,r.length-1),window.open("keeper.html#/finance/search?"+r,"_blank")},t.detailFn1=function(e,s){var o={};o.startTime=a("date")(e,"yyyy-MM-dd HH:mm:ss"),o.endTime=e+" 23:59:59",t.posts.selector&&(o.reason=t.posts.selector),s&&(o.channel=s);var n="";for(var r in o)n+=r+"="+o[r]+"&";n=n.substring(0,n.length-1),window.open("keeper.html#/finance/searchday?"+n,"_blank")},t.$watch("view.page",function(e,a){e&&a&&e!==a&&(json.page=t.view.result.page,json.count=t.view.result.count,t.view.result=ajaxSendFn(json,"/finance/shop","GET").result||[])})}]),app.controller("FinanceSearchCtr",["$rootScope","$scope","$location","shopFactory",function(e,t,a,s){t.config.class="doc",t.view={};var o=a.search();t.view=ajaxSendFn(o,"/finance/detail/shop","GET").result,t.$watch("view.page",function(e,a){e&&a&&e!==a&&(o.page=t.view.page,o.count=t.view.count,t.view=ajaxSendFn(o,"/finance/detail/shop","GET").result)})}]),app.controller("FinanceSearchDayCtr",["$rootScope","$scope","$location","$filter",function(e,t,a,s){t.config.class="finance",t.view={projects:{901:"消费",902:"充值",904:"升级",909:"收款",907:"打赏"}},t.posts={};var o=a.search();t.data=o.startTime.substring(0,10);var n=ajaxSendFn(o,"/finance/shop","GET");(n.code=200)?t.view.result=n.result||[]:alert(n.message),t.detailFn=function(e,t,a){var n={};n.startTime=s("date")(o.startTime,"yyyy-MM-dd HH:mm:ss"),n.endTime=s("date")(o.endTime,"yyyy-MM-dd HH:mm:ss"),a&&(n.reason=a),t&&(n.channel=t);var r="";for(var i in n)r+=i+"="+n[i]+"&";r=r.substring(0,r.length-1),window.open("keeper.html#/finance/search?"+r,"_blank")},t.$watch("view.page",function(e,a){e&&a&&e!==a&&(o.page=t.view.result.page,o.count=t.view.result.count,t.view.result=ajaxSendFn(o,"/finance/shop","GET").result||[])})}]),app.controller("sourceCtr",["$scope","$http","$routeParams","$filter","$location","CouponFactory",function(e,t,a,s,o,n){e.config.breadset=[{name:"素材管理",href:indexUrl+"/keeper.html#/rule/source",class:"source"},{name:"素材管理"}],e.posts={},e.types={1000:"转介绍首页",1001:"转介绍任务分享",2001:"预定首页"};var r=ajaxSendFn({},"/posters","GET");console.log(r),200==r.code?(console.log("data 200"),e.posts=r.result.items):(console.log("data errer"),console.log(r)),e.removeFn=function(e){var t=ajaxSendFn({},"/posters/"+e,"DELETE");200==t.code?alert("操作成功"):alert(t.message)}}]),app.controller("addsourceCtr",["$scope","$http","$routeParams","$filter","$location","CouponFactory",function(e,t,a,s,o,n){e.config.breadset=[{name:"素材管理",href:indexUrl+"/keeper.html#/rule/addsource",class:"addsource"},{name:"素材管理"}],e.posts={},e.types=[{id:"1000",name:"转介绍首页"},{id:"1001",name:"转介绍任务分享"},{id:"2001",name:"预定首页"}],e.sendJsons=function(){if(console.log(e.posts),!e.posts.picUrl)return void alert("请先上传图片");var t=angular.copy(e.posts);console.log(t);var a="/posters",s=ajaxSendFn(t,a,"POST");200==s.code?alert("操作成功"):alert(s.message)}}]),app.controller("editsourceCtr",["$scope","$http","$routeParams","$filter","$location","CouponFactory",function(e,t,a,s,o,n){e.config.breadset=[{name:"素材管理",href:indexUrl+"/keeper.html#/rule/editsource",class:"editsource"},{name:"素材管理"}],e.posts={},e.types=[{id:"1000",name:"转介绍首页"},{id:"1001",name:"转介绍任务分享"},{id:"2001",name:"预定首页"}],e.posts=ajaxSendFn({},"/posters/"+a.id,"GET").result,e.sendJsons=function(){if(!e.posts.picUrl)return void alert("请先上传图片");var t=angular.copy(e.posts);console.log(t);var s="/posters/"+a.id,o=ajaxSendFn(t,s,"PUT");200==o.code?alert("操作成功"):alert(o.message)}}]);