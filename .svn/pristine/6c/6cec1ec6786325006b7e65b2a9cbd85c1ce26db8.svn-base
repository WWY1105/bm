function appRouteConfig(t){t.when("/statistics",{templateUrl:"public/js/common/statistics.html",controller:"StatisticsCtr"}).when("/statistics/charge/:shopId",{templateUrl:"public/js/directive/rechargeTemp.html",controller:"DetailCtr"}).when("/statistics/coupon/:shopId",{templateUrl:"public/js/directive/couponTemp.html",controller:"DetailCtr"}).when("/statistics/sms/:shopId",{templateUrl:"public/js/directive/smsTemp.html",controller:"DetailCtr"}).when("/statistics/relation/:shopId",{templateUrl:"public/js/directive/relationTemp.html",controller:"DetailCtr"}).when("/statistics/point/:shopId",{templateUrl:"public/js/directive/pointTemp.html",controller:"DetailCtr"})}appRouteConfig.$inject=["$routeProvider"],angular.module("app").directive("buttons",function(){return{restrict:"AE",replace:!0,scope:{selector:"="},templateUrl:"public/js/directive/buttons.html",controller:["$scope","$filter",function(t,e){t.select=function(e){t.selector=e}}]}}),angular.module("app").directive("couponNew",["CouponFactory","memberGradeFactory","shopFactory","$filter",function(t,e,a,s){return{restrict:"EA",replace:!0,scope:{addOk:"&",addFail:"&"},templateUrl:"public/js/directive/couponNew.html",link:function(e,r,o){e.couponCategoryRev={901:"代金券",902:"实物券"},e.ruleCategory=getShareCategory("COUPON_CONSUME"),e.couponTimeSel=couponRangeCategory,e.today=s("date")(new Date,"yyyy-MM-dd"),e.coupon={dateRange:{}},e.shops=a.getAllShops(),e.coupon.shops=[],e.coupon.shared=[],e.coupon.periods=[],e.posts={},e.checkAllShop=!1,e.checkAllCatagory=function(){e.posts.catagoryAll?angular.forEach(e.ruleCategory,function(t,e){this[e]=t.id},e.coupon.shared):e.coupon.shared=[]},e.checkAllShops=function(){e.checkAllShop?angular.forEach(e.shops,function(t,e){this[e]=t.id},e.coupon.shops):e.coupon.shops=[]},e.$watch("coupon.dateRangeCategory",function(t,a){t&&t!=a&&(e.coupon.dateRange={})}),e.addCouponInner=function(){var a=[1001,1002,1003,1004,1005];for(i=1;i<6;i++)e.coupon["time"+i]&&e.coupon.periods.push(a[i-1]),delete e.coupon["time"+i];if(e.coupon.periods=unique(e.coupon.periods),e.coupon.dateRange.endDate<e.coupon.dateRange.startDate)return void alert("结束时间不能小于开始时间");if(e.coupon.dateRange.startDate&&(e.coupon.dateRange.startDate=s("date")(e.coupon.dateRange.startDate,"yyyy-MM-dd 00:00:00")),e.coupon.dateRange.endDate&&(e.coupon.dateRange.endDate=s("date")(e.coupon.dateRange.endDate,"yyyy-MM-dd 23:59:59")),"901"===e.coupon.category&&(e.coupon.value=e.coupon.currentAmount=0),e.coupon.dateRange.selectCategory=e.coupon.dateRange.selectCategory||"NONE",e.coupon.shops=arrRemoveNullFN(e.coupon.shops),e.coupon.shared=arrRemoveNullFN(e.coupon.shared),"NONE"!==e.coupon.dateRange.selectCategory)if("MANUAL_SELECT"===e.coupon.data.subType){var r=arrayMap(objectKeys(e.coupon.data.selectDates),function(t){return t+" 00:00:00"});isEmptyObject(r)||(e.coupon.dateRange.selectDates=r)}else if("MONTH_DAYS"===e.coupon.data.subType){var r=arrayMap(objectKeys(mapFilter(e.coupon.data.selectDays,notNull)),parseInt);isEmptyObject(r)||(e.coupon.dateRange.selectDays=r)}else if("WEEKLY_DAY"===e.coupon.data.subType){var r=arrayMap(objectKeys(mapFilter(e.coupon.data.selectWeekDays,notNull)),parseInt);isEmptyObject(r)||(e.coupon.dateRange.selectWeekDays=r)}delete e.coupon.data;var o=t.addCoupon(e.coupon);200==o.code?e.addOk():e.addFail({result:o})}}}}]),angular.module("app").directive("myDatePicker",function(){return{restrict:"EA",replace:!0,scope:{data:"=",dateRange:"=",isEdit:"="},templateUrl:"public/js/directive/datepicker.html",controller:["$scope",function(t){t.topDateRangeCategory=[{type:"PERMANENT",name:"永久有效"},{type:"CONTINUOUS",name:"周期有效"},{type:"BIRTHDAY",name:"生日相关"},{type:"SELECTED_DATES",name:"指定日期"}];var e=new Date;e.setFullYear(2e3),e.setMonth(1),e.setDate(1);var a=new Date;a.setDate(a.getDate()-1),a.setHours(23),a.setMinutes(59),a.setSeconds(59);var i=new Date;t.set={periods:[]},t.view={periods:[]},t.dateOptions={formatYear:"yy",startingDay:1,minDate:e,maxDate:new Date(i.getTime()+31536e7)},t.opened={startDate:!1,endDate:!1},t.clickBtn=function(e){t.data.dateType=e},t.open=function(e,a){e.preventDefault(),e.stopPropagation(),t.opened[a]=!0},t.disabled=function(t,e){return!1},t.$watch("data.dateType",function(e,a){e&&e!==a&&(t.data[e]||(t.data[e]={}),t.data[e].dateRange||(t.data[e].dateRange={}),t.dateRange=t.data[e].dateRange,"CONTINUOUS"===e&&(t.dateRange.startDate=parseDate(t.dateRange.startDate||i),t.dateRange.endDate=parseDate(t.dateRange.endDate||i)))}),t.dateRange||(t.dateRange={}),t.data||(t.data={}),"CONTINUOUS"===t.data.dateType&&(t.dateRange.startDate=parseDate(t.dateRange.startDate||i),t.dateRange.endDate=parseDate(t.dateRange.endDate||i)),t.dateRangeCategory=dateRangeCategory}]}}),angular.module("app").directive("searchByDate",function(){return{restrict:"AE",replace:!0,scope:{startTime:"=",endTime:"=",text:"=",needSearch:"=",shops:"=",shopId:"="},templateUrl:"public/js/directive/search.html",controller:["$scope","$filter",function(t,e){t.posts={},t.init=function(){if(t.startTime){var e=new Date,a=Date.parse(t.startTime);e.setTime(a),t.starttime=e}else{var i=new Date;i.setDate(i.getDate()-1),i.setHours(0),i.setMinutes(0),i.setSeconds(0),t.starttime=i}if(t.endTime){var s=new Date,a=Date.parse(t.endTime);s.setTime(s),t.endtime=s}else{var s=new Date;t.endtime=s}t.posts.shopId=t.shopId},t.doSearch=function(){t.shopId=t.posts.shopId,t.startTime=e("date")(t.starttime,"yyyy-MM-dd 00:00:00"),t.endTime=e("date")(t.endtime,"yyyy-MM-dd 23:59:59"),t.needSearch=!0}}]}}),angular.module("app").directive("mySpecialDate",function(){return{restrict:"EA",replace:!0,scope:{specialDate:"="},templateUrl:"public/js/directive/specialDate.html",controller:["$scope",function(t){t.specialDateRangeCategory=[{type:"MANUAL_SELECT",name:"手动选择"},{type:"MONTH_DAYS",name:"按月选择"},{type:"WEEKLY_DAY",name:"按周选择"}],t.week=[{idx:1,value:"周日"},{idx:2,value:"周一"},{idx:3,value:"周二"},{idx:4,value:"周三"},{idx:5,value:"周四"},{idx:6,value:"周五"},{idx:7,value:"周六"}],t.clickBtn=function(e){t.specialDate.subType=e},t.range=function(t,e){var a=[];e||(e=t,t=0);for(var i=t;i<=e;i++)a.push(i);return a},t.clickDay=function(t,e){var a=e.hasOwnProperty(t);a?delete e[t]:e[t]=!0},t.specialDate||(t.specialDate={selectDates:{},selectWeekDays:{},selectDays:{}}),t.set={periods:[]},t.view={periods:[]},t.date={now:new Date,nows:{year:(new Date).getFullYear(),day:(new Date).getDate(),month:(new Date).getMonth()+1},week:["日","一","二","三","四","五","六"],dates:[],i:0,year:(new Date).getFullYear(),day:(new Date).getDate(),month:(new Date).getMonth()+1},t.dateFn=function(e,a){t.date.dates=[],firstdate=e+"-"+a+"-1 00:00:00",firstdate=new Date(firstdate),firstday=firstdate.getDay(),ny=e,nm=a,a>=12?(nm=1,ny++):nm++,nextMonth=ny+"-"+nm+"-1 00:00:00",nextMonth=new Date(new Date(nextMonth).getTime()-864e5),lastdate=nextMonth.getDate(),lastday=nextMonth.getDay(),et=new Date((new Date).getTime()+63072e6);var s=t.date.nows.year,r=t.date.nows.month,o=t.date.nows.day,n=et.getFullYear(),c=et.getMonth()+1,l=et.getDate();for(i=0,j=lastdate-lastday+5+firstday;i<=j;i++)if(i<firstday-1)t.date.dates.push({day:""});else if(i>=lastdate+firstday)t.date.dates.push({day:""});else{var u=0;(e<s&&a<r||e==s&&a==r&&i-firstday+1<o||e>=n&&a>c||e==n&&a==c&&i-firstday+1>l)&&(u=1),trues=[],trues[0]=e,trues[1]=a>9?a:"0"+a,trues[2]=i-firstday+1>9?i-firstday+1:"0"+(i-firstday+1),trues=trues.join("-"),t.date.dates.push({day:i-firstday+1,ture:trues,color:u})}},t.datego=function(e){tem=t.date.i+e,tem>=0&&tem<240&&(t.date.i+=e,t.date.month+=e,t.date.month>12?(t.date.month=1,t.date.year++):t.date.month<1&&(t.date.month=12,t.date.year--),t.dateFn(t.date.year,t.date.month))},t.dateFn(t.date.year,t.date.month),t.specialDate.selectDates=formatDatas(t.specialDate.selectDates),t.specialDate.selectDays=formatDatas(t.specialDate.selectDays),t.specialDate.selectWeekDays=formatDatas(t.specialDate.selectWeekDays)}]}}),angular.module("app").directive("statisticsCoupon",["statisticsFacotry",function(t){var e=StatisticsDirective.createNew(t,"public/js/directive/statisticsCoupon.html","/statistics/coupon/",t.queryCouponStatistics);return e}]),angular.module("app").directive("statisticsCouponDetail",["statisticsFacotry","$routeParams","STATISTICS_TYPE",function(t,e,a){var i=StatisticsDetailDirective.createNew(t,"public/js/directive/statisticsCouponDetail.html",t.queryCouponDetailStatistics,e,a);return i}]),angular.module("app").directive("statisticsPoint",["statisticsFacotry",function(t){var e=StatisticsDirective.createNew(t,"public/js/directive/statisticsPoint.html","/statistics/point/",t.queryPointStatistics);return e}]),angular.module("app").directive("statisticsPointDetail",["statisticsFacotry","$routeParams","STATISTICS_TYPE",function(t,e,a){var i=StatisticsDetailDirective.createNew(t,"public/js/directive/statisticsPointDetail.html",t.queryPointDetailStatistics,e,a);return i}]),angular.module("app").directive("statisticsRecharge",["statisticsFacotry",function(t){var e=StatisticsDirective.createNew(t,"public/js/directive/statisticsRecharge.html","/statistics/charge/",t.queryChargeStatistics);return e}]),angular.module("app").directive("statisticsRechargeDetail",["statisticsFacotry","$routeParams","STATISTICS_TYPE",function(t,e,a){var i=StatisticsDetailDirective.createNew(t,"public/js/directive/statisticsRechargeDetail.html",t.queryChargeDetailStatistics,e,a);return i}]),angular.module("app").directive("statisticsRelation",["statisticsFacotry",function(t){var e=StatisticsDirective.createNew(t,"public/js/directive/statisticsRelation.html","/statistics/relation/",t.queryRelationStatistics);return e}]),angular.module("app").directive("statisticsRelationDetail",["statisticsFacotry","$routeParams","STATISTICS_TYPE",function(t,e,a){var i=StatisticsDetailDirective.createNew(t,"public/js/directive/statisticsRelationDetail.html",t.queryRelationDetailStatistics,e,a);return i}]),angular.module("app").directive("statisticsSms",["statisticsFacotry",function(t){var e=StatisticsDirective.createNew(t,"public/js/directive/statisticsSms.html","/statistics/sms/",t.querySmsStatistics);return e}]),angular.module("app").directive("statisticsSmsDetail",["statisticsFacotry","$routeParams","STATISTICS_TYPE",function(t,e,a){var i=StatisticsDetailDirective.createNew(t,"public/js/directive/statisticsSmsDetail.html",t.querySmsDetailStatistics,e,a);return i}]),angular.module("app").factory("CouponFactory",["$http",function(t){var e={};return e.getAllCoupon=function(){return ajaxSendFn({},"/coupon","GET").result||[]},e.addCoupon=function(t){return ajaxSendFn(JSON.stringify(t),"/coupon","POST",1)},e}]),angular.module("app").factory("memberGradeFactory",["$http",function(t){var e={};return e.getAllGrade=function(){return ajaxSendFn({},"/memberGrade","GET").result||[]},e}]),angular.module("app").factory("shopFactory",["$http",function(t){var e={};return e.getAllShops=function(){return ajaxSendFn({state:1002},"/shops","GET").result||[]},e}]),angular.module("app").factory("deviceFactory",["$http",function(t){var e={};return e.getAllDevices=function(t){return ajaxSendFn(t||{},"/activate","GET").result||[]},e.jihuo=function(t){var e=ajaxSendFn({},"/activate","POST");200==e.code?t(e):alert(e.message)},e}]),angular.module("app").factory("statisticsFacotry",["$http",function(t){var e=function(e,a,i){t({method:"GET",url:e,params:objSort(a)}).then(function(t){i(t.data)},function(t){alert(t.message)})},a={};return a.queryChargeStatistics=function(t,a){var i=basicUrl+"/statistics/charge";return e(i,t,a)},a.queryChargeDetailStatistics=function(t,a){var i=basicUrl+"/statistics/charge/detail";return e(i,t,a)},a.queryPointStatistics=function(t,a){var i=basicUrl+"/statistics/point?";return e(i,t,a)},a.queryPointDetailStatistics=function(t,a){var i=basicUrl+"/statistics/point/detail?";return e(i,t,a)},a.queryCouponStatistics=function(t,a){var i=basicUrl+"/statistics/coupon?";return e(i,t,a)},a.queryCouponDetailStatistics=function(t,a){var i=basicUrl+"/statistics/coupon/detail?";return e(i,t,a)},a.querySmsStatistics=function(t,a){var i=basicUrl+"/statistics/shortmessage?";return e(i,t,a)},a.querySmsDetailStatistics=function(t,a){var i=basicUrl+"/statistics/shortmessage/detail?";return e(i,t,a)},a.queryRelationStatistics=function(t,a){var i=basicUrl+"/statistics/consumption?";return e(i,t,a)},a.queryRelationDetailStatistics=function(t,a){var i=basicUrl+"/statistics/consumption/detail?";return e(i,t,a)},a}]),angular.module("app").config(appRouteConfig),angular.module("app").constant("STATISTICS_TYPE",{get:"发放",use:"兑换"});var StatisticsDetail={createNew:function(t,e,a,i,s){var r={};r.$rootScope=t,r.$scope=e,r.$location=a,r.$routeParams=i,r.$scope.posts={},r.$scope.view={},t.cache.shops||(r.$rootScope.cache.shops=s.getAllShops()),r.$scope.view.shops=r.$rootScope.cache.shops,r.$scope.view.shopId=r.$routeParams.shopId;var o=r.$location.search().startTime,n=r.$location.search().endTime;return o&&n&&(r.$scope.posts.startTime=o,r.$scope.posts.endTime=n),r}},StatisticsDirective={createNew:function(t,e,a,i,s){var r={restrict:"AE",replace:!0,scope:{startTime:"=",endTime:"=",needSearch:"=",page:"=",count:"=",total:"=",shopId:"="},templateUrl:e};return r.controller=function(e,s){e.view={},e.showDetail=function(t){var i=a+t;s.search("endTime",e.endTime),s.search("startTime",e.startTime),s.path(i)};var r=function(t){e.view.result=t.result,e.needSearch=!1};e.$watch("page",function(a,s){if(a&&s&&a!==s){var o={page:e.page,endTime:e.endTime,startTime:e.startTime};i.call(t,o,r)}}),e.$watch("needSearch",function(a){if(a){var s={endTime:e.endTime,startTime:e.startTime};i.call(t,s,function(t){return 200!==t.code?(403e3==t.code?location.href=indexUrl:e.total=0,e.needSearch=!1,void delete e.view.result):(e.total=t.result.total,e.count=t.result.count,e.page=t.result.page,void r(t))})}})},r}},StatisticsDetailDirective={createNew:function(t,e,a,i,s){var r={restrict:"AE",replace:!0,scope:{startTime:"=",endTime:"=",needSearch:"=",page:"=",count:"=",total:"=",shopId:"="},templateUrl:e};return r.controller=function(e,r){e.view={},e.STATISTICS_TYPE=s,!e.shopId&&i.shopId&&(e.shopId=i.shopId);var o=function(t){e.result=t.result,e.needSearch=!1};e.$watch("page",function(t,a){if(t&&a&&t!==a){var i={page:e.page,startTime:e.startTime,endTime:e.endTime};e.shopId&&(i.shopId=e.shopId),e.sendPost(i,o)}}),e.$watch("needSearch",function(t){if(t){var a={startTime:e.startTime,endTime:e.endTime};e.shopId&&(a.shopId=e.shopId),e.sendPost(a,function(t){e.total=t.result.total,e.count=t.result.count,e.page=t.result.page,o(t)})}}),e.sendPost=function(i,s){a.call(t,i,function(t){return 200!==t.code?(e.total=0,e.needSearch=!1,delete e.view.result,void alert(t.message)):void s(t)})};var n=r.search().startTime,c=r.search().endTime;if(n&&c){var l={};l.endTime=e.endTime=c,l.startTime=e.startTime=n,l.shopId=e.shopId,e.sendPost(l,function(t){e.total=t.result.total,e.count=t.result.count,e.page=t.result.page,o(t)})}},r}};app.controller("StatisticsCtr",["$rootScope","$scope","$location","shopFactory",function(t,e,a,i){e.posts={},e.view={},t.cache={shops:i.getAllShops()},e.config.breadset=[{name:"统计报表",href:indexUrl+"/admin.html#/statistics"},{name:"统计报表"}]}]),app.controller("DetailCtr",["$rootScope","$scope","$location","$routeParams","shopFactory",function(t,e,a,i,s){StatisticsDetail.createNew(t,e,a,i,s)}]);