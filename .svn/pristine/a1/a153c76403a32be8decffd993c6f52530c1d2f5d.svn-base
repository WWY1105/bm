function appRouteConfig(e){e.when("/doc/detail/:orderId",{templateUrl:"admin/doc/detail.html",controller:"OrderCtr"})}appRouteConfig.$inject=["$routeProvider"],angular.module("app").directive("buttons",["TYPE",function(e){return{restrict:"AE",replace:!0,scope:{selector:"=",direct:"=",total:"="},templateUrl:"public/js/directive/buttons.html",controller:["$scope",function(e){e.select=function(t){e.selector=t,e.direct=0}}]}}]),angular.module("app").directive("couponNew",["CouponFactory","memberGradeFactory","shopFactory","$filter",function(e,t,a,r){return{restrict:"EA",replace:!0,scope:{addOk:"&",addFail:"&"},templateUrl:"public/js/directive/couponNew.html",link:function(t,n,o){t.couponCategoryRev={901:"代金券",902:"实物券"},t.ruleCategory=getShareCategory("COUPON_CONSUME"),t.couponTimeSel=couponRangeCategory,t.today=r("date")(new Date,"yyyy-MM-dd"),t.coupon={dateRange:{}},t.shops=a.getAllShops(),t.coupon.shops=[],t.coupon.shared=[],t.coupon.periods=[],t.posts={},t.checkAllShop=!1;var s=ajaxSendFn({},"/nonParticipation","GET");t.nonParticipationId=s.result?s.result._id:{},t.checkAllCatagory=function(){t.posts.catagoryAll?angular.forEach(t.ruleCategory,function(e,t){this[t]=e.id},t.coupon.shared):t.coupon.shared=[]},t.checkAllShops=function(){t.checkAllShop?angular.forEach(t.shops,function(e,t){this[t]=e.id},t.coupon.shops):t.coupon.shops=[]},t.$watch("coupon.dateRangeCategory",function(e,a){e&&e!=a&&(t.coupon.dateRange={})}),t.addCouponInner=function(){var a=[1001,1002,1003,1004,1005];for(i=1;i<6;i++)t.coupon["time"+i]&&t.coupon.periods.push(a[i-1]),delete t.coupon["time"+i];if(t.coupon.periods=unique(t.coupon.periods),t.coupon.dateRange.endDate<t.coupon.dateRange.startDate)return void alert("结束时间不能小于开始时间");if(t.coupon.dateRange.startDate&&(t.coupon.dateRange.startDate=r("date")(t.coupon.dateRange.startDate,"yyyy-MM-dd 00:00:00")),t.coupon.dateRange.endDate&&(t.coupon.dateRange.endDate=r("date")(t.coupon.dateRange.endDate,"yyyy-MM-dd 23:59:59")),"901"===t.coupon.category&&(t.coupon.value=t.coupon.currentAmount=0),t.coupon.dateRange.selectCategory=t.coupon.dateRange.selectCategory||"NONE",t.coupon.shops=arrRemoveNullFN(t.coupon.shops),t.coupon.shared=arrRemoveNullFN(t.coupon.shared),"NONE"!==t.coupon.dateRange.selectCategory)if("MANUAL_SELECT"===t.coupon.data.subType){var n=arrayMap(objectKeys(t.coupon.data.selectDates),function(e){return e+" 00:00:00"});isEmptyObject(n)||(t.coupon.dateRange.selectDates=n)}else if("MONTH_DAYS"===t.coupon.data.subType){var n=arrayMap(objectKeys(mapFilter(t.coupon.data.selectDays,notNull)),parseInt);isEmptyObject(n)||(t.coupon.dateRange.selectDays=n)}else if("WEEKLY_DAY"===t.coupon.data.subType){var n=arrayMap(objectKeys(mapFilter(t.coupon.data.selectWeekDays,notNull)),parseInt);isEmptyObject(n)||(t.coupon.dateRange.selectWeekDays=n)}delete t.coupon.data;var o=e.addCoupon(t.coupon);200==o.code?t.addOk():t.addFail({result:o})}}}}]),angular.module("app").directive("myDatePicker",function(){return{restrict:"EA",replace:!0,scope:{data:"=",dateRange:"=",isEdit:"="},templateUrl:"public/js/directive/datepicker.html",controller:["$scope",function(e){e.topDateRangeCategory=[{type:"PERMANENT",name:"永久有效"},{type:"CONTINUOUS",name:"周期有效"},{type:"BIRTHDAY",name:"生日相关"},{type:"SELECTED_DATES",name:"指定日期"}];var t=new Date;t.setFullYear(2e3),t.setMonth(1),t.setDate(1);var a=new Date;a.setDate(a.getDate()-1),a.setHours(23),a.setMinutes(59),a.setSeconds(59);var i=new Date;e.set={periods:[]},e.view={periods:[]},e.dateOptions={formatYear:"yy",startingDay:1,minDate:t,maxDate:new Date(i.getTime()+31536e7)},e.opened={startDate:!1,endDate:!1},e.clickBtn=function(t){e.data.dateType=t},e.open=function(t,a){t.preventDefault(),t.stopPropagation(),e.opened[a]=!0},e.disabled=function(e,t){return!1},e.$watch("data.dateType",function(t,a){t&&t!==a&&(e.data[t]||(e.data[t]={}),e.data[t].dateRange||(e.data[t].dateRange={}),e.dateRange=e.data[t].dateRange,"CONTINUOUS"===t&&(e.dateRange.startDate=parseDate(e.dateRange.startDate||i),e.dateRange.endDate=parseDate(e.dateRange.endDate||i)))}),e.dateRange||(e.dateRange={}),e.data||(e.data={}),"CONTINUOUS"===e.data.dateType&&(e.dateRange.startDate=parseDate(e.dateRange.startDate||i),e.dateRange.endDate=parseDate(e.dateRange.endDate||i)),e.dateRangeCategory=dateRangeCategory}]}}),angular.module("app").directive("searchByDate",["shopFactory",function(e){return{restrict:"AE",replace:!0,templateUrl:"public/js/directive/search.html",controller:["$scope",function(e){e.init=function(){if(e.posts.startTime){var t=new Date,a=Date.parse(e.posts.startTime);t.setTime(a),e.posts.startTime=t}else{var i=new Date;i.setDate(i.getDate()-370),i.setHours(0),i.setMinutes(0),i.setSeconds(0),e.posts.startTime=i}if(e.posts.endTime){var r=new Date,a=Date.parse(e.posts.endTime);r.setTime(r),e.posts.endTime=r}else{var r=new Date;e.posts.endTime=r}},e.init(),e.doSearch=function(){return void 0===e.posts.shopId?void alert("请先选择对应的门店"):(""==e.posts.shopId?e.view.direct=1:e.view.direct=2,void(e.view.needSearch=!0))}}]}}]),angular.module("app").directive("mySpecialDate",function(){return{restrict:"EA",replace:!0,scope:{specialDate:"="},templateUrl:"public/js/directive/specialDate.html",controller:["$scope",function(e){e.specialDateRangeCategory=[{type:"MANUAL_SELECT",name:"手动选择"},{type:"MONTH_DAYS",name:"按月选择"},{type:"WEEKLY_DAY",name:"按周选择"}],e.week=[{idx:1,value:"周日"},{idx:2,value:"周一"},{idx:3,value:"周二"},{idx:4,value:"周三"},{idx:5,value:"周四"},{idx:6,value:"周五"},{idx:7,value:"周六"}],e.clickBtn=function(t){e.specialDate.subType=t},e.range=function(e,t){var a=[];t||(t=e,e=0);for(var i=e;i<=t;i++)a.push(i);return a},e.clickDay=function(e,t){var a=t.hasOwnProperty(e);a?delete t[e]:t[e]=!0},e.specialDate||(e.specialDate={selectDates:{},selectWeekDays:{},selectDays:{}}),e.set={periods:[]},e.view={periods:[]},e.date={now:new Date,nows:{year:(new Date).getFullYear(),day:(new Date).getDate(),month:(new Date).getMonth()+1},week:["日","一","二","三","四","五","六"],dates:[],i:0,year:(new Date).getFullYear(),day:(new Date).getDate(),month:(new Date).getMonth()+1},e.dateFn=function(t,a){e.date.dates=[],firstdate=t+"-"+a+"-1 00:00:00",firstdate=new Date(firstdate),firstday=firstdate.getDay(),ny=t,nm=a,a>=12?(nm=1,ny++):nm++,nextMonth=ny+"-"+nm+"-1 00:00:00",nextMonth=new Date(new Date(nextMonth).getTime()-864e5),lastdate=nextMonth.getDate(),lastday=nextMonth.getDay(),et=new Date((new Date).getTime()+63072e6);var r=e.date.nows.year,n=e.date.nows.month,o=e.date.nows.day,s=et.getFullYear(),c=et.getMonth()+1,d=et.getDate();for(i=0,j=lastdate-lastday+5+firstday;i<=j;i++)if(i<firstday-1)e.date.dates.push({day:""});else if(i>=lastdate+firstday)e.date.dates.push({day:""});else{var u=0;(t<r&&a<n||t==r&&a==n&&i-firstday+1<o||t>=s&&a>c||t==s&&a==c&&i-firstday+1>d)&&(u=1),trues=[],trues[0]=t,trues[1]=a>9?a:"0"+a,trues[2]=i-firstday+1>9?i-firstday+1:"0"+(i-firstday+1),trues=trues.join("-"),e.date.dates.push({day:i-firstday+1,ture:trues,color:u})}},e.datego=function(t){tem=e.date.i+t,tem>=0&&tem<240&&(e.date.i+=t,e.date.month+=t,e.date.month>12?(e.date.month=1,e.date.year++):e.date.month<1&&(e.date.month=12,e.date.year--),e.dateFn(e.date.year,e.date.month))},e.dateFn(e.date.year,e.date.month),e.specialDate.selectDates=formatDatas(e.specialDate.selectDates),e.specialDate.selectDays=formatDatas(e.specialDate.selectDays),e.specialDate.selectWeekDays=formatDatas(e.specialDate.selectWeekDays)}]}}),angular.module("app").directive("statisticsCoupon",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsCoupon.html","coupon");return e}),angular.module("app").directive("statisticsCouponDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsCouponDetail.html","coupon");return e}),angular.module("app").directive("statisticsPoint",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsPoint.html","point");return e}),angular.module("app").directive("statisticsPointDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsPointDetail.html","point");return e}),angular.module("app").directive("statisticsRecharge",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsRecharge.html","recharge");return e}),angular.module("app").directive("statisticsRechargeDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsRechargeDetail.html","recharge");return e}),angular.module("app").directive("statisticsRelationDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsRelationDetail.html","consumption");return e}),angular.module("app").directive("statisticsRelation",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsRelation.html","consumption");return e}),angular.module("app").directive("statisticsSms",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsSms.html","shortmessage");return e}),angular.module("app").directive("statisticsSmsDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsSmsDetail.html","shortmessage");return e}),angular.module("app").directive("statisticsUpgrade",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsUpgrade.html","upgrade");return e}),angular.module("app").directive("statisticsUpgradeDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsUpgradeDetail.html","upgrade");return e}),angular.module("app").directive("statisticsOther",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsOther.html","receivables");return e}),angular.module("app").directive("statisticsOtherDetail",function(){var e=StatisticsDirective.createNew("public/js/directive/statisticsOtherDetail.html","receivables");return e}),angular.module("app").factory("CouponFactory",["$http",function(e){var t={};return t.getAllCoupon=function(){return ajaxSendFn({},"/coupon","GET").result||[]},t.addCoupon=function(e){return ajaxSendFn(JSON.stringify(e),"/coupon","POST",1)},t}]),angular.module("app").factory("memberGradeFactory",["$http",function(e){var t={};return t.getAllGrade=function(){return ajaxSendFn({},"/memberGrade","GET").result||[]},t}]),angular.module("app").factory("shopFactory",["$http",function(e){var t={};return t.getAllShops=function(){return ajaxSendFn({state:1002},"/shops","GET").result||[]},t}]),angular.module("app").factory("deviceFactory",["$http",function(e){var t={};return t.getAllDevices=function(e){return ajaxSendFn(e||{},"/activate","GET").result||[]},t.jihuo=function(e){var t=ajaxSendFn({},"/activate","POST");200==t.code?e(t):alert(t.message)},t}]),angular.module("app").config(appRouteConfig),angular.module("app").constant("TYPE",["consumption","coupon","point","receivables","recharge","shortmessage","upgrade"]);var StatisticsDirective={createNew:function(e,t){var a={restrict:"AEC",replace:!0,scope:{needSearch:"=",page:"=",count:"=",total:"=",post:"="},templateUrl:e};return a.controller=function(e,a,i){e.view={};var r=function(a){var r;return e.startTime=i("date")(e.post.startTime,"yyyy-MM-dd 00:00:00"),e.endTime=i("date")(e.post.endTime,"yyyy-MM-dd 23:59:59"),a.endTime=e.endTime,a.startTime=e.startTime,e.post.shopId?(a.shopId=e.post.shopId,r=ajaxSendFn(a,"/order/"+t+"/list","GET")):r=ajaxSendFn(a,"/order/"+t+"/stat/list","GET"),200!==r.code?(403e3==r.code?location.href=indexUrl:e.total=0,e.needSearch=!1,void delete e.view.result):(e.total=r.result.total,e.count=r.result.count,e.page=r.result.page,void(e.view.result=r.result))};e.$watch("page",function(t,a){t&&a&&t!==a&&r({page:e.page,count:e.count})}),e.$watch("needSearch",function(a){if(a){r({count:15});var i={endTime:e.endTime,startTime:e.startTime};e.post.shopId&&(i.shopId=e.post.shopId);var n=ajaxSendFn(i,"/order/"+t+"/statall","GET");200==n.code&&(e.view.collection=n.result)}})},a}};app.controller("OrderCtr",["$rootScope","$scope","$routeParams",function(e,t,a){t.config.class="doc",t.view={orderId:a.orderId,item:ajaxSendFn({},"/order/"+a.orderId,"GET").result||""};var r=0;for(i in t.view.item.strategy)t.view.item.strategy.hasOwnProperty(i)&&r++;r>3&&(t.view.item.show=1)}]);