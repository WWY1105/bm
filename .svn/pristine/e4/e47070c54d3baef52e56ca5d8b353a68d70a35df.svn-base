function ajaxSendFn(e,t,n,a){var r,o="5d85a0398cb74c66a46affbb98efaf41";return $.cookie("apikey")||$.cookie("apikey",o,{expire:30,path:"/"}),"GET"==n||"get"==n?$.ajax({url:basicUrl+t,data:objSort(e),type:n,dataType:"json",async:!1,beforeSend:function(e){1==a&&e.setRequestHeader("Content-Type","application/json")},success:function(e){return 403e3==e.code?void(location.href=indexUrl):4e5==e.code?void alert(e.message):(200!=e.code&&console.log(e.message),void(r=e))},loading:function(){}}):(e="string"==typeof e?e:JSON.stringify(e),$.ajax({url:basicUrl+t+"?"+sortUrl(),data:e,type:n,dataType:"json",async:!1,beforeSend:function(e){e.setRequestHeader("Content-Type","application/json")},success:function(e){return 403e3==e.code?void(location.href=indexUrl):(200!=e.code&&console.log(e.message),void(r=e))}})),r}function formatDate(e,t){if(e){switch(t||(t="yyyy-MM-dd"),typeof e){case"string":e=new Date(e.replace(/-/g,"/"));break;case"number":e=new Date(e)}if(!(!e instanceof Date)){var n={yyyy:e.getFullYear(),M:e.getMonth()+1,d:e.getDate(),H:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),MM:(""+(e.getMonth()+101)).substr(1),dd:(""+(e.getDate()+100)).substr(1),HH:(""+(e.getHours()+100)).substr(1),mm:(""+(e.getMinutes()+100)).substr(1),ss:(""+(e.getSeconds()+100)).substr(1)};return t.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g,function(){return n[arguments[0]]})}}}function arrRemoveNullFN(e){var t=[];return $.each(e,function(e,n){""!=n&&"null"!=n&&null!=n&&n&&t.push(n)}),t}function arrToObj(e,t,n){var a={};for(i=0,j=e.length;i<j;i++)n?a[e[i][t]]=e[i][n]:a[e[i][t]]=e[i];return a}function obj2Array(e,t){var n=[];for(var a in e)t?n.push(e[a][t]):n.push(e[a]);return n}function in_array(e,t){for(s=0;s<t.length;s++)if(thisEntry=t[s].toString(),thisEntry==e)return!0;return!1}function remove_empty(e){for(var t=0;t<e.length;t++)""!=e[t]&&"undefined"!=typeof e[t]||(e.splice(t,1),t-=1);return e}function concatUrl(e,t){return""!==t?e+"/"+t:e}function unique(e){for(var t=[],n=0,a=e.length;n<a;n++){for(var r=n+1;r<a;r++)e[n]===e[r]&&(r=++n);t.push(e[n])}return t}function errorMsg(e){e&&alert(e.message)}var basicUrl=location.origin,indexUrl=location.origin,authed={1001:"创建中",1002:"认证审核中",1003:"已通过审核",1004:"关闭审核中",1005:"停用"},textCheckJson={name:/^[a-zA-z]{1}[a-zA-Z0-9]{5,15}$/,password:/^[\w]{8,20}$/,telephone:/^0[1-9]{2,3}-?[2-9][0-9]{6,7}(-?[0-9]{1,4})?|1[0-9]{10}$/,phone:/^1\d{10}$/,tel:/^[1-9]{2,3}-?[2-9][0-9]{6,7}(-?[0-9]{1,4})?$/,nickname:/^[\u4e00-\u9fa5\w\S]{2,20}$/,dictCode:/^[0-9]{2,10}$/,dictText:/^[\u4e00-\u9fa5\w]{1,20}$/,dictName:/^[\u4e00-\u9fa5]{2,10}$/,dictMnemonic:/^[a-zA-Z_]{2,20}$/,shopcode:/^[a-zA-Z0-9]{1,20}$/,"float-regex":/^\-?\d+((\.|\,)\d+)?$/},textCheckErrorJson={name:"必须以字母开头，不得含有汉字及其他符号",password:"不能含有空格",telephone:"请输入正确电话号码",phone:"请输入正确电话号码",tel:"请输入正确电话号码",nickname:"不能含有空格及特殊字符",dictCode:"只能为数字",dictText:"只能为汉字",dictName:"只能为汉字",dictMnemonic:"只能输入下划线及英文",shopcode:"只能输入英文及数字"},constUrlDict={"staffs-base":"/staffs",login:"/staffs/login",logout:"/staffs/logout",staff:"/staffs/staff","staffs-shop":"/staffs/shop","staffs-keeper":"/staffs/keeper","staffs-password":"/staffs/password",customer:"/customer",memberGrade:"/memberGrade",benefit:"/benefit",coupon:"/coupon/usable",tables:"/tables","tables-batch":"/tables/batch","tables-box":"/tables/box","tables-table":"/tables/table","tables-shop":"/tables/shop",businesstimes:"/businesstimes",businesstime:"/businesstimes/businesstime",activity:"/activity"},obtainRepeatCategory=[{id:"AFTER_CHECK",name:"核销后可重领"},{id:"UNLIMITED",name:"无限制"}],dateRangeCategory=[{type:"PERMANENT",name:"永久有效"},{type:"CONTINUOUS",name:"连续有效"},{type:"SELECTED_DATES",name:"手动选择"},{type:"MONTH_EFFECTIVE",name:"当月有效"},{type:"EXCLUDE_MONTH_DAYS",name:"按月排除"},{type:"EXCLUDE_WEEKLY_DAY",name:"按周排除"},{type:"AROUND_FIX_DATE",name:"生日"},{type:"INCLUDE_WEEKLY_DAY",name:"按周指定"},{type:"INCLUDE_MONTH_DAYS",name:"按月指定"}],couponRangeCategory={CONTINUOUS:"连续有效",AUTOMATIC_DAY_DELAY:"延期生效",AUTOMATIC_MONTH_DELAY:"月底有效"},ruleCategory=[{id:"FOLLOW",name:"关注有礼"},{id:"COUPONFREE",name:"送券"},{id:"CHARGE",name:"充值"},{id:"GIVENUPGRADE",name:"升级赠送"},{id:"EXCHANGE",name:"积分兑换"},{id:"DISCOUNT",name:"打折"},{id:"SPECIALPRICE",name:"特价"},{id:"COUPON",name:"消费返券"},{id:"POINT",name:"消费积分"},{id:"POINTCONSUME",name:"积分抵现"},{id:"CHARGECONSUME",name:"使用充值卡"},{id:"LIMITREDUCE",name:"满减"},{id:"SPENDAS",name:"抵扣"},{id:"SETMEAL",name:"套餐组合"}],onlineRuleObj=[{id:"FOLLOW",name:"关注有礼"},{id:"COUPONFREE",name:"送券"},{id:"CHARGE",name:"充值"},{id:"GIVENUPGRADE",name:"升级赠送"},{id:"EXCHANGE",name:"积分兑换"},{id:"BIRTHBENEFIT",name:"生日活动"}],consumeRuleObj=[{id:"DISCOUNT",name:"打折"},{id:"SPECIALPRICE",name:"特价"},{id:"COUPON",name:"消费返券"},{id:"POINT",name:"消费积分"},{id:"POINTCONSUME",name:"积分抵现"},{id:"CHARGECONSUME",name:"使用充值卡"},{id:"LIMITREDUCE",name:"满减"},{id:"SPENDAS",name:"抵扣"},{id:"SETMEAL",name:"套餐组合"},{id:"CHARGEFREE",name:"充值免单"}],ruleCategoryForCoupon=[{id:"DISCOUNT",name:"打折"},{id:"SPECIALPRICE",name:"特价"},{id:"COUPON",name:"消费返券"},{id:"POINT",name:"消费积分"},{id:"LIMITREDUCE",name:"满减"},{id:"SPENDAS",name:"抵扣"}],allRuleCategory={DISCOUNT:"打折",SPECIALPRICE:"特价",COUPON:"消费返券",COUPON_CONSUME:"消费用券",COUPONFREE:"送券",POINT:"积分",POINTCONSUME:"积分抵现",CHARGE:"充值",CHARGECONSUME:"使用充值卡",WELFARE:"福利",LIMITREDUCE:"满减",SPENDAS:"抵扣",SETMEAL:"套餐组合",GIVENUPGRADE:"升级赠送"},sharedActivitys={DISCOUNT:["POINT","COUPON","CHARGECONSUME","POINTCONSUME"],SPECIALPRICE:["DISCOUNT","POINT","COUPON","CHARGECONSUME"],COUPON_CONSUME:["COUPON","POINT","CHARGECONSUME"],COUPON_CONSUME1:["COUPON","POINT","CHARGECONSUME","DISCOUNT","POINTCONSUME","LIMITREDUCE","SPENDAS","SPECIALPRICE","SETMEAL"],POINTCONSUME:["COUPON","POINT","CHARGECONSUME"],COUPON:["POINT"],POINT:["COUPON"],CHARGECONSUME:["POINT","COUPON"],LIMITREDUCE:["POINT","COUPON","CHARGECONSUME","POINTCONSUME"],SPENDAS:["POINT","COUPON","CHARGECONSUME"],SETMEAL:["POINT","COUPON","CHARGECONSUME","DISCOUNT"]},ConsumeTypeCategory={6005:"DISCOUNT",6006:"SPECIALPRICE",6010:"COUPONCONSUME",6009:"POINTCONSUME",6011:"CHARGECONSUME",6014:"LIMITREDUCE",6012:"SPENDAS",6015:"SETMEAL",6016:"REWARD",6040:"BARGAIN",6017:"CHARGEFREE"},shopTypeJson={1001:"有桌台",1002:"没桌台"},relationSourceType={9001:"上宾",9002:"老数据"},constMember=[{id:"CUSTOMER",name:"非会员"}],mergeParam=function(e){var t=[];return angular.forEach(e,function(e,n){t.push(n+"="+e)}),t.join("&")},parseDate=function(e){if(e){var t;if("string"==typeof e){t=new Date;var n=Date.parse(e);t.setTime(n)}else t=e;return t}},modules=["ngRoute","720kb.tooltips","ngMessages","angular-loading-bar","ngAnimate","ui.bootstrap","highcharts-ng"];"/keeper.html"==location.pathname&&(modules=["ngRoute","720kb.tooltips","ngMessages","angular-loading-bar","ngAnimate","ui.bootstrap","highcharts-ng","monospaced.qrcode","ui.calendar"]);var app=angular.module("app",modules);app.run(["$rootScope","$location","$interval","$filter","$http","$templateCache",function(e,t,n,a,r,o){e.cache={},e.config={time:new Date,shopname:$.cookie("shopname")+"管理系统",breadset:{},slide:"",modalcontent:"",textCheckJson:textCheckJson,textCheckErrorJson:textCheckErrorJson},e.config.staff=ajaxSendFn({},constUrlDict.staff,"GET",1).result,e.config.permission=ajaxSendFn({},"/activity/permission","GET").result,e.urlFn=function(){return t.$$path?(localurl=t.$$path.split("/"),""==localurl[1]&&(localurl[1]="shops"),void(e.active=localurl[1])):void(e.active="shops")},e.urlFn(),e.goto=function(n){t.path("/"+n),e.urlFn()},e.logout=function(){logoutre=ajaxSendFn({},constUrlDict.logout,"POST"),$.cookie("shopname",null,{path:"/"}),$.cookie("token",null,{path:"/"}),200==logoutre.code&&(location.href=indexUrl)}}]),app.directive("dyName",[function(){return{require:"ngModel",link:function(e,t,n,a){a.$name=e.$eval(n.dyName);var r=t.controller("form")||{$addControl:angular.noop};r.$addControl(a),e.$on("$destroy",function(){r.$removeControl(a)})}}}]),app.filter("ltdate",function(){return function(e){if(e)return new Date(Date.parse(e.replace(/-/g,"/")))}}),app.filter("trust2Html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),app.filter("ltnumber",function(){return function(e){return parseInt(e)}}),app.filter("splitcode",function(){return function(e,t,n){for(var a=[],r=t||4,o=0;o<e.length;o+=r){var i=e.substr(o,r);a.push(i)}return a.join(n||"-")}}),app.filter("substr",function(){return function(e,t){return e&&e.length>t?e.substr(0,t)+"...":e}}),app.factory("tyAjaxFactory",["$http",function(e){var t={};return t.get=function(t,n,a,r){var o;e.get(basicUrl+a+"?"+sortUrl()).success(function(e){deferred.resolve(e)}).success().then(function(e){o=e.data,$scope.cache={n:o}})},t}]),app.factory("tyFnFactory",["$http","tyAjaxFactory",function(e,t){var n={};return n.shop=function(e){return t.get(e,{},"/shops")},n}]),app.directive("backButton",function(){return{restrict:"A",link:function(e,t,n){function a(){history.back(),e.$apply()}t.bind("click",a)}}}),app.directive("countDown",["$interval",function(e){return{scope:{repeats:"="},restrict:"A",link:function(t,n,a){function r(){var a=t.repeats,r=n.val(),o=e(function(){n.attr("disabled",!0),n.val(a--+"秒后再试")},1e3,t.repeats);o.then(function(){n.val(r),n.attr("disabled",!1)},function(){n.val("error...")}),t.$on("$destroy",function(t){e.cancel(o)})}n.bind("click",r)}}}]),app.directive("inPut",function(){return{restrict:"EA",scope:{age:"@dateType"},link:function(e,t,n){}}}),app.factory("SearchSettingService",["$http","$q",function(e,t){return{setting:function(){var n=t.defer();return e.get(basicUrl+"/shops?"+sortUrl()).success(function(e){n.resolve(e)}).error(function(e){n.reject("network error")}),n.promise}}}]);var notNull=function(e){return null!=e&&e&&""!=e},uniqArr=function(e){if(e)return e.filter(function(e,t,n){return n.indexOf(e)==t})},getSubtimes=function(e,t){var n={};return angular.forEach(e,function(e,n){t[e]&&(this[e]=t[e])},n),n},isEmptyObject=function(e){for(var t in e)return!1;return!0},objectCount=function(e){var t=0;return angular.forEach(e,function(e,n){t++}),t};getShareCategory=function(e){for(var t=[],n=sharedActivitys[e],a=0;n&&a<n.length;a++){var r={};r.id=n[a],r.name=allRuleCategory[n[a]],t.push(r)}return t},objectKeys=function(e){var t=[];return angular.forEach(e,function(e,t){this.push(t)},t),t},arrayMap=function(e,t){var n=[];return"function"==typeof t?angular.forEach(e,function(e,n){var a=e;a=t(e),this.push(a)},n):n=e,n},arrayFilter=function(e,t){var n=[];return"function"==typeof t?angular.forEach(e,function(e,n){t(e)&&this.push(e)},n):n=e,n},mapFilter=function(e,t){var n={};return"function"==typeof t?angular.forEach(e,function(e,n){t(e)&&(this[n]=e)},n):n=e,n},formatDatas=function(e){if(e)if(e.constructor===Array){var t={};angular.forEach(e,function(e,t){this[e]=!0},t)}else t=e;else t={};return t};