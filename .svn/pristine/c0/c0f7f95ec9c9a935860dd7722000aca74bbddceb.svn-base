function ajaxSendFn(e,t,n,o){var a,r="5d85a0398cb74c66a46affbb98efaf41";return $.cookie("apikey")||$.cookie("apikey",r,{expire:30,path:"/"}),"GET"==n||"get"==n?$.ajax({url:basicUrl+t,data:objSort(e),type:n,dataType:"json",async:!1,beforeSend:function(e){1==o&&e.setRequestHeader("Content-Type","application/json")},success:function(e){2!=o&&(4140!=e.code&&403e3!=e.code||(location.href=indexUrl)),200!=e.code&&console.log(e.message),a=e},loading:function(){}}):(e="string"==typeof e?e:JSON.stringify(e),$.ajax({url:basicUrl+t+"?"+sortUrl(),data:e,type:n,dataType:"json",async:!1,beforeSend:function(e){e.setRequestHeader("Content-Type","application/json")},success:function(e){2!=o&&403e3==e.code&&(location.href=indexUrl),200!=e.code&&console.log(e.message),a=e}})),a}function ajaxSendFn2(e,t,n,o){var a,r="5d85a0398cb74c66a46affbb98efaf41";return $.cookie("apikey",r,{expire:30,path:"/"}),$.ajax({url:basicUrl+t,data:objSort(e),type:n,dataType:"json",beforeSend:function(e){1==o&&e.setRequestHeader("Content-Type","application/json")},success:function(e){2!=o&&403e3==e.code&&(location.href=indexUrl),a=e},loading:function(){}}),a}function arrRemoveNullFN(e){var t=[];return $.each(e,function(e,n){""!=n&&null!=n&&n&&t.push(n)}),t}function arrToObj(e,t,n){var o={};for(i=0,j=e.length;i<j;i++)n?o[e[i][t]]=e[i][n]:o[e[i][t]]=e[i];return o}function obj2Array(e,t){var n=[];for(var o in e)t?n.push(e[o][t]):n.push(e[o]);return n}function in_array(e,t){for(s=0;s<t.length;s++)if(thisEntry=t[s].toString(),thisEntry==e)return!0;return!1}function remove_empty(e){for(var t=0;t<e.length;t++)""!=e[t]&&"undefined"!=typeof e[t]||(e.splice(t,1),t-=1);return e}function concatUrl(e,t){return""!==t?e+"/"+t:e}function unique(e){for(var t=[],n=0,o=e.length;n<o;n++){for(var a=n+1;a<o;a++)e[n]===e[a]&&(a=++n);t.push(e[n])}return t}function errorMsg(e){e&&alert(e.message)}var basicUrl=location.origin,indexUrl=location.origin,authed={1001:"创建中",1002:"认证审核中",1003:"已通过审核",1004:"关闭审核中",1005:"停用"},textCheckJson={name:/^[a-zA-z]{1}[a-zA-Z0-9]{5,15}$/,password:/^[\w]{8,20}$/,telephone:/^0[1-9]{2,3}-?[2-9][0-9]{6,7}(-?[0-9]{1,4})?|1[0-9]{10}$/,phone:/^1\d{10}$/,tel:/^[1-9]{2,3}-?[2-9][0-9]{6,7}(-?[0-9]{1,4})?$/,nickname:/^[\u4e00-\u9fa5\w\S]{2,20}$/,dictCode:/^[0-9]{2,10}$/,dictText:/^[\u4e00-\u9fa5\w]{1,20}$/,dictName:/^[\u4e00-\u9fa5]{2,10}$/,dictMnemonic:/^[a-zA-Z_]{2,20}$/,shopcode:/^[a-zA-Z0-9]{1,20}$/,"float-regex":/^\-?\d+((\.|\,)\d+)?$/},textCheckErrorJson={name:"必须以字母开头，不得含有汉字及其他符号",password:"不能含有空格",telephone:"请输入正确电话号码",phone:"请输入正确电话号码",tel:"请输入正确电话号码",nickname:"不能含有空格及特殊字符",dictCode:"只能为数字",dictText:"只能为汉字",dictName:"只能为汉字",dictMnemonic:"只能输入下划线及英文",shopcode:"只能输入英文及数字"},constUrlDict={"staffs-base":"/staffs",login:"/staffs/login",logout:"/staffs/logout",staff:"/staffs/staff","staffs-shop":"/staffs/shop","staffs-keeper":"/staffs/keeper","staffs-password":"/staffs/password",customer:"/customer",memberGrade:"/memberGrade",benefit:"/benefit",coupon:"/coupon/usable",tables:"/tables","tables-batch":"/tables/batch","tables-box":"/tables/box","tables-table":"/tables/table","tables-shop":"/tables/shop",businesstimes:"/businesstimes",businesstime:"/businesstimes/businesstime",activity:"/activity"},obtainRepeatCategory=[{id:"AFTER_CHECK",name:"核销后可重领"},{id:"UNLIMITED",name:"无限制"}],dateRangeCategory=[{type:"PERMANENT",name:"永久有效"},{type:"CONTINUOUS",name:"连续有效"},{type:"SELECTED_DATES",name:"手动选择"},{type:"MONTH_EFFECTIVE",name:"当月有效"},{type:"EXCLUDE_MONTH_DAYS",name:"按月排除"},{type:"EXCLUDE_WEEKLY_DAY",name:"按周排除"},{type:"AROUND_FIX_DATE",name:"生日"},{type:"INCLUDE_WEEKLY_DAY",name:"按周指定"},{type:"INCLUDE_MONTH_DAYS",name:"按月指定"}],couponRangeCategory={CONTINUOUS:"连续有效",AUTOMATIC_DAY_DELAY:"延期生效",AUTOMATIC_MONTH_DELAY:"月底有效"},ruleCategory=[{id:"FOLLOW",name:"关注有礼"},{id:"COUPONFREE",name:"送券"},{id:"CHARGE",name:"充值"},{id:"EXCHANGE",name:"积分兑换"},{id:"DISCOUNT",name:"打折"},{id:"SPECIAL_PRICE",name:"特价"},{id:"COUPON",name:"消费返券"},{id:"POINT",name:"消费积分"},{id:"POINTCONSUME",name:"积分抵现"},{id:"CHARGECONSUME",name:"使用充值卡"}],allRuleCategory={DISCOUNT:"打折",SPECIALPRICE:"特价",COUPON:"消费返券",COUPON_CONSUME:"消费用券",COUPONFREE:"送券",POINT:"积分",POINTCONSUME:"积分抵现",CHARGE:"充值",CHARGECONSUME:"使用充值卡",WELFARE:"福利"},sharedActivitys={DISCOUNT:["POINT","COUPON","CHARGECONSUME"],SPECIAL_PRICE:["DISCOUNT","POINT","COUPON","CHARGECONSUME"],COUPON_CONSUME:["COUPON","POINT","CHARGECONSUME"],POINTCONSUME:["COUPON","POINT","CHARGECONSUME"],COUPON:["POINT"],POINT:["COUPON"],CHARGECONSUME:["POINT","COUPON"]},shopTypeJson={1001:"有桌台",1002:"没桌台"},relationSourceType={9001:"上宾",9002:"老数据"},mergeParam=function(e){var t=[];return angular.forEach(e,function(e,n){t.push(n+"="+e)}),t.join("&")},parseDate=function(e){if(e){var t;if("string"==typeof e){t=new Date;var n=Date.parse(e);t.setTime(n)}else t=e;return t}},app=angular.module("app",["ngRoute","720kb.tooltips","ngMessages","angular-loading-bar","ngAnimate","ui.bootstrap","highcharts-ng","monospaced.qrcode"]);app.run(["$rootScope","$location","$interval","$filter","$http",function(e,t,n,o,a){e.cache={},e.config={time:new Date,shopname:$.cookie("shopname")+"管理系统",breadset:{},slide:"",modalcontent:"",textCheckJson:textCheckJson,textCheckErrorJson:textCheckErrorJson},e.config.staff=ajaxSendFn({},constUrlDict.staff,"GET",1).result,n(function(){e.config.time=new Date},1e3),e.urlFn=function(){return t.$$path?(localurl=t.$$path.split("/"),""==localurl[1]&&(localurl[1]="shops"),void(e.active=localurl[1])):void(e.active="shops")},e.urlFn(),e.goto=function(n){t.path("/"+n),e.urlFn()},e.logout=function(){logoutre=ajaxSendFn({},constUrlDict.logout,"POST"),$.cookie("shopname",null,{path:"/"}),$.cookie("token",null,{path:"/"}),200==logoutre.code&&(location.href=indexUrl)}}]),app.directive("dyName",[function(){return{require:"ngModel",link:function(e,t,n,o){o.$name=e.$eval(n.dyName);var a=t.controller("form")||{$addControl:angular.noop};a.$addControl(o),e.$on("$destroy",function(){a.$removeControl(o)})}}}]),app.filter("ltdate",function(){return function(e){if(e)return new Date(Date.parse(e.replace(/-/g,"/")))}}),app.filter("ltnumber",function(){return function(e){return parseInt(e)}}),app.filter("splitcode",function(){return function(e,t,n){for(var o=[],a=t||4,r=0;r<e.length;r+=a){var i=e.substr(r,a);o.push(i)}return o.join(n||"-")}}),app.filter("substr",function(){return function(e,t){return e&&e.length>t?e.substr(0,t)+"...":e}}),app.factory("tyAjaxFactory",["$http",function(e){var t={};return t.get=function(t,n,o,a){var r;e.get(basicUrl+o+"?"+sortUrl()).success(function(e){deferred.resolve(e)}).success().then(function(e){r=e.data,$scope.cache={n:r}})},t}]),app.factory("tyFnFactory",["$http","tyAjaxFactory",function(e,t){var n={};return n.shop=function(e){return t.get(e,{},"/shops")},n}]),app.directive("backButton",function(){return{restrict:"A",link:function(e,t,n){function o(){history.back(),e.$apply()}t.bind("click",o)}}}),app.directive("countDown",["$interval",function(e){return{scope:{repeats:"="},restrict:"A",link:function(t,n,o){function a(){var o=t.repeats,a=n.val(),r=e(function(){n.attr("disabled",!0),n.val(o--+"秒后再试")},1e3,t.repeats);r.then(function(){n.val(a),n.attr("disabled",!1)},function(){n.val("error...")}),t.$on("$destroy",function(t){e.cancel(r)})}n.bind("click",a)}}}]),app.directive("inPut",function(){return{restrict:"EA",scope:{age:"@dateType"},link:function(e,t,n){}}}),app.factory("SearchSettingService",["$http","$q",function(e,t){return{setting:function(){var n=t.defer();return e.get(basicUrl+"/shops?"+sortUrl()).success(function(e){n.resolve(e)}).error(function(e){n.reject("network error")}),n.promise}}}]);