function getObjectURL(e){return varurl=null,void 0!=window.createObjectURL?url=window.createObjectURL(e):void 0!=window.URL?url=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(url=window.webkitURL.createObjectURL(e)),url}app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"keeper/index.html",controller:"HomeCtr"}).when("/staff/",{templateUrl:"keeper/Staff/show.html",controller:"StaffShowCtr"}).when("/shop/",{templateUrl:"keeper/Shop/index.html",controller:"ShopCtr"}).when("/shop/add",{templateUrl:"keeper/Shop/add.html",controller:"ShopAddCtr"}).when("/shop/add2",{templateUrl:"keeper/Shop/add2.html",controller:"ShopAdd2Ctr"}).when("/shop/add3",{templateUrl:"keeper/Shop/add3.html",controller:"ShopAdd3Ctr"}).when("/shop/add4",{templateUrl:"keeper/Shop/add4.html",controller:"ShopAdd4Ctr"}).when("/shop/add5",{templateUrl:"keeper/Shop/add5.html",controller:"ShopAdd5Ctr"}).when("/shop/businesstime",{templateUrl:"keeper/Shop/businesstime.html",controller:"ShopBusinesstimeCtr"}).when("/shop/add2re",{templateUrl:"keeper/Shop/add2re.html",controller:"ShoptablesCtr"}).when("/tables",{templateUrl:"keeper/Shop/tables.html",controller:"ShoptablesCtr"}).when("/shop/edit",{templateUrl:"keeper/Shop/edit.html",controller:"ShopAddCtr"}).when("/staff/staffedit/:guestid",{templateUrl:"keeper/Staff/staffedit.html",controller:"StaffeditCtr"}).when("/staff/dutyedit/:guestid",{templateUrl:"keeper/Staff/dutyedit.html",controller:"StaffdutyeditCtr"}).when("/staff/staffadd",{templateUrl:"keeper/Staff/staffadd.html",controller:"StaffaddCtr"}).when("/comment",{templateUrl:"keeper/comment.html",controller:"CommentCtr"}).when("/customer/charge/:userId",{templateUrl:"keeper/customer/charge.html",controller:"CustomerChargeCtr"}).when("/customer/point/:userId",{templateUrl:"keeper/customer/point.html",controller:"CustomerPoicustomerntCtr"}).when("/customer/coupon/:userId",{templateUrl:"keeper/customer/coupon.html",controller:"CustomerCouponCtr"}).when("/customer/add",{templateUrl:"keeper/customer/add.html",controller:"CustomerAddCtr"}).when("/customer",{templateUrl:"keeper/customer/index.html",controller:"CustomerCtr"}).when("/rule",{templateUrl:"keeper/rule/index.html",controller:"RuleCtr"}).when("/rule/member",{templateUrl:"keeper/rule/member.html",controller:"RulememberCtr"}).when("/staff/password/:guestid",{templateUrl:"keeper/Staff/password.html",controller:"passwordCtr"}).when("/password",{templateUrl:"my/password.html",controller:"edit_passwordCtr"}).when("/devices",{templateUrl:"keeper/devices/index.html",controller:"DevicesCtr"}).when("/dish",{templateUrl:"keeper/dish/index.html",controller:"DishCtr"}).when("/doc",{templateUrl:"keeper/doc/index.html",controller:"DocCtr"}).otherwise({redirectTo:"/"})}]),app.controller("HomeCtr",["$scope",function(e){e.ruleDic={nonParticipations:"不参与活动商品",periods:"有效时段",time:"时间",shops:"分店"},e.config.breadset=[{name:"首页"}],e.view={customerCount:{},shop:ajaxSendFn({},"/shops/shop/desc","GET").result||[]},customerCount=ajaxSendFn({},"/customer/count","GET").result||[];for(var t in customerCount)e.view.customerCount[customerCount[t].type]=customerCount[t];e.view.rule=ajaxSendFn({},"/activity","GET").result||[];for(t in e.view.rule){tem=e.view.rule[t],e.view.rule[t].icon={};for(y in tem.rules)tem.rules[y].type=tem.rules[y].type.split("_"),e.view.rule[t].icon[tem.rules[y].type[0]]=1}e.view.satisfaction={1001:"很棒",1002:"一般",1003:"较差"};var s=ajaxSendFn({},"/shops/shop/comment","GET").result;s&&(e.view.comment=s.items||[])}]),app.controller("ShopCtr",["$scope","$location","$filter",function(e,t,s){return e.config.breadset=[{name:"我的门店"}],e.shop=ajaxSendFn({},"/shops/shop","GET").result,e.shop.businessTimes?(e.view={},e.tem={uploadTitle:"选择要上传的图片"},e.tem.type={1001:"早市",1002:"午市",1003:"下午茶",1004:"晚市",1005:"夜宵"},e.authed={1001:"创建中",1002:"认证审核中",1003:"已通过审核",1004:"关闭审核中",1005:"停用"},e.view={businesstime:{1001:{startTime:"",endTime:""},1002:{startTime:"",endTime:""},1003:{startTime:"",endTime:""},1004:{startTime:"",endTime:""},1005:{startTime:"",endTime:""}}},e.shop.openingDay=s("ltdate")(e.shop.openingDay),e.addpic=function(){e.tempic="",$("#addpic").modal("show")},e.temimgshow=function(t){var s=getObjectURL(t.files[0]);s&&(e.tempic=s,e.tem={uploadTitle:"已选择"})},e.sendimg=function(t){POSTurl=basicUrl+"/pic/shop?",options={url:POSTurl+sortUrl(),type:"POST",success:function(t){200===t.code?(e.shop.picUrls.push(t.result),$("#addpic").modal("hide")):(alert("图片上传失败"),e.tem.uploadTitle="选择要上传的图片")}},$("#iimgform").ajaxSubmit(options)},e.removeImg=function(t){removere=ajaxSendFn({},"/pic/"+e.shop.picUrls[t].id,"DELETE"),200==removere.code&&e.shop.picUrls.splice(t,1)},e.setCover=function(e){var t=ajaxSendFn({url:e},"/pic/shop/cover","POST");200==t.code?alert("设置成功"):errorMsg(t)},e.bigpicshow=function(t){e.view.bigpic=t.substring(0,t.lastIndexOf(".",t))+"_1"+t.substring(t.lastIndexOf(".",t)),$("#bigpic").modal("show")},e.shopedit=function(){e.posts=e.shop,e.view.style=ajaxSendFn({},"/dict/CUISINE/item","GET").result;for(var t=0;t<e.view.style.length;t++)e.posts.cuisineText==e.view.style[t].text&&(e.posts.cuisine=e.view.style[t].code);e.area={area1:e.posts.area.substring(0,2)+"0000",area2:e.posts.area.substring(0,4)+"00",area3:e.posts.area},e.areaJson1=ajaxSendFn({},"/dict/area","GET").result,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3||(e.area.area2=e.posts.area,delete e.area.area3),e.area1change=function(t){e.areaChanged=!0,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.area.area2=e.areaJson2[0].code,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},e.area2change=function(t){e.areaChanged=!0,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},$("#shopedit").modal("show")},void(e.senposts=function(){e.config.modalLink="",sends={tel:e.posts.tel,openingDay:s("date")(e.posts.openingDay,"yyyy-MM-dd HH:mm:ss"),cuisine:e.posts.cuisine,avgprice:e.posts.avgprice,area:e.areaChanged?e.area.area3||e.area.area2:e.posts.area,address:e.posts.address,latitude:e.posts.latitude||"",longitude:e.posts.longitude||"",parkingDescription:e.posts.parkingDescription||"",description:e.posts.description||"",id:e.posts.id},sendJson=JSON.stringify(sends),postsend=ajaxSendFn(sendJson,"/shops/shop/"+e.posts.id,"POST",1),200==postsend.code?($("#shopedit").modal("hide"),alert("保存成功"),e.shop=ajaxSendFn({},"/shops/shop","GET").result):alert(postsend.message)})):void t.path("/shop/add")}]),app.controller("ShopAddCtr",["$scope","$filter","$location",function(e,t,s){e.tem={uploadTitle:"选择要上传的图片"},e.areaChanged=!1,e.getShop=ajaxSendFn({},"/shops/shop","GET").result,e.posts=e.getShop,e.posts.openingDay||(e.posts.openingDay=t("date")(e.config.time,"yyyy-MM-dd HH:mm:ss")),e.posts.openingDay=new Date(Date.parse(e.posts.openingDay.replace(/-/g,"/")));var a=e.config.time;a.setDate(a.getDate()+180),e.view={endtime:a,picurl:{}},e.view.style=ajaxSendFn({},"/dict/CUISINE/item","GET").result,e.area={area1:e.posts.area.substring(0,2)+"0000",area2:e.posts.area.substring(0,4)+"00",area3:e.posts.area},e.areaJson1=ajaxSendFn({},"/dict/area","GET").result,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3||(e.area.area2=e.posts.area,delete e.area.area3),e.view.picurl=ajaxSendFn({source:"9002"},"/pic/shop","GET").result||[],e.area1change=function(t){e.areaChanged=!0,e.areaJson2=ajaxSendFn({code:e.area.area1},"/dict/area","GET").result,e.area.area2=e.areaJson2[0].code,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},e.area2change=function(t){e.areaChanged=!0,e.areaJson3=ajaxSendFn({code:e.area.area2},"/dict/area","GET").result,e.areaJson3&&e.areaJson3.length>0?e.area.area3=e.areaJson3[0].code:delete e.area.area3},mapFn=function(t){t.latitude&&t.longitude&&(e.view.map="http://restapi.amap.com/v3/staticmap?zoom=14&size=200*120&markers=-1,http://webapi.amap.com/images/1.png,0:"+t.longitude+","+t.latitude+"&key=ee95e52bf08006f63fd29bcfbcf21df0",console.log(e.view.map))},initialize=function(t,s){function a(){var a;AMap.service(["AMap.Geocoder"],function(){a=new AMap.Geocoder({radius:5e3}),a.getLocation(t.city+t.address,function(t,a){if("complete"===t&&"OK"===a.info){var r=new Array;r=a.geocodes,1==s?latlng=o(0,r[0],e.posts):latlng=o(0,r[0]),n.setFitView()}})})}function o(t,s,a){if(e.posts.latitude&&e.posts.longitude&&!a)var o=e.posts.latitude,d=e.posts.longitude;else var d=s.location.getLng(),o=s.location.getLat();e.view.latitude=o,e.view.longitude=d;var l={map:n,icon:"http://webapi.amap.com/images/"+(t+1)+".png",position:new AMap.LngLat(d,o),draggable:!0,cursor:"move",raiseOnDrag:!0},p=new AMap.Marker(l);r.push(new AMap.LngLat(d,o));var c=new AMap.InfoWindow({content:s.formattedAddress,autoMove:!0,size:new AMap.Size(150,0),offset:{x:0,y:-30}});i.push(c);var u=function(t){e.view.latitude=p.getPosition().lat,e.view.longitude=p.getPosition().lng};AMap.event.addListener(p,"dragend",u)}t.address&&""!=t.address||(t.address=t.qu);var n,r=new Array,i=new Array;n=new AMap.Map(t.id),a()},mapFn(e.posts),e.mapModal=function(){temcity=e.getShop.areaText.split("省"),2==temcity.length&&(temcity[0]=temcity[1]),temcity=temcity[0].split("市");var t={id:"mapin",latitude:e.posts.latitude,longitude:e.posts.longitude,city:temcity[0]+"市",qu:temcity[1],address:e.posts.address};initialize(t),$("#map").modal("show")},e.addpic=function(){e.tempic="",$("#addpic").modal("show")},e.temimgshow=function(t){var s=getObjectURL(t.files[0]);s&&(e.tempic=s,e.tem={uploadTitle:"已选择"})},e.sendimg=function(t){POSTurl=basicUrl+"/pic/shop?",options={url:POSTurl+sortUrl(),type:"POST",success:function(t){200===t.code?(e.view.picurl.push(t.result),$("#addpic").modal("hide")):(alert("图片上传失败"),e.tem.uploadTitle="选择要上传的图片")}},$("#iimgform").ajaxSubmit(options)},e.senposts=function(a){e.config.modalLink="",sends={tel:e.posts.tel,openingDay:t("date")(e.posts.openingDay,"yyyy-MM-dd HH:mm:ss"),cuisine:e.posts.cuisine,avgprice:e.posts.avgprice,area:e.areaChanged?e.area.area3||e.area.area2:e.posts.area,address:e.posts.address,latitude:e.posts.latitude,longitude:e.posts.longitude,parkingDescription:e.posts.parkingDescription,description:e.posts.description,id:e.posts.id},sendJson=JSON.stringify(sends),postsend=ajaxSendFn(sendJson,"/shops/shop/"+e.posts.id,"POST",1),200==postsend.code?a?(alert("保存成功"),s.path("/shop/")):"1002"==e.getShop.shopType?s.path("/shop/add3/"):s.path("/shop/add2/"):alert(postsend.message)},e.resetpostion=function(t){temcity=ajaxSendFn({},"/dict/AREA/"+e.posts.area+"/text","GET").result.text,temcity=temcity.split("省"),2==temcity.length&&(temcity[0]=temcity[1]),temcity=temcity[0].split("市");var s={id:"mapin",latitude:e.posts.latitude,longitude:e.posts.longitude,city:temcity[0]+"市",qu:temcity[1],address:e.posts.address};initialize(s,1),$("#map").modal("show")},e.imgEditFn=function(e){console.log(e.target)},e.setpostion=function(){e.posts.latitude=e.view.latitude,e.posts.longitude=e.view.longitude,mapFn(e.posts),$("#map").modal("hide")},e.removeImg=function(t){removere=ajaxSendFn({},"/pic/"+e.view.picurl[t].id,"DELETE"),200==removere.code&&(e.view.picurl.splice(t,1),console.log(e.view.picurl))},e.setCover=function(e){var t=ajaxSendFn({url:e},"/pic/shop/cover","POST");200==t.code?alert("设置成功"):errorMsg(t)},e.bigpicshwo=function(t){e.view.bigpic=t.substring(0,t.lastIndexOf(".",t))+"_1"+t.substring(t.lastIndexOf(".",t)),$("#bigpic").modal("show")}}]),app.controller("ShopAdd2Ctr",["$scope","$location",function(e,t){e.gettable=ajaxSendFn({},"/tables","GET"),404e3!=e.gettable.code&&t.path("/shop/add2re"),e.view={table:[],box:[]},e.addtable=function(){e.tem={table:{}},$("#addtable").modal("show")},e.removeFn=function(t,s){e.view[t].splice(s,1)},e.reset=function(t){e.view.table[t].count<1&&(e.view.table[t].count=1)},e.addTbaleFn=function(){e.tem.table.seat&&e.tem.table.count&&(e.view.table.push(e.tem.table),$("#addtable").modal("hide"))},e.addBox=function(){e.tem={box:{seatNum:null,name:null,no:null,type:"1001"}},$("#addbox").modal("show")},e.addBoxFn=function(){e.tem.box.seatNum&&e.tem.box.name&&e.tem.box.no&&e.tem.box.seatNum>0&&(console.log(typeof e.tem.box.seatNum),e.view.box.push(e.tem.box),$("#addbox").modal("hide"))},e.sendposts=function(){var s=0;e.view.table.length>0&&(sendJson=angular.toJson(e.view.table),send1=ajaxSendFn(sendJson,"/tables","POST",1),200==send1.code&&s++),e.view.box.length>0&&(sendJson2=angular.toJson(e.view.box),send2=ajaxSendFn(sendJson2,"/tables/box","POST",1),200==send2.code&&s++),s>0&&t.path("/shop/add3")}}]),app.controller("ShopAdd3Ctr",["$scope","$location","$filter",function(e,t,s){for(e.shopshow={businesstime:ajaxSendFn({},"/businesstimes","GET").result},console.log(e.shopshow),e.posts=[{type:"1001",startTime:"",endTime:""},{type:"1002",startTime:"",endTime:""},{type:"1003",startTime:"",endTime:""},{type:"1004",startTime:"",endTime:""},{type:"1005",startTime:"",endTime:""}],e.tem={time:[],buname:["早市","午市","下午茶","晚市","宵夜"]},i=0;i<24;i++)e.tem.time.push(i+":00");e.sendposts=function(){var a=[];for(i=0;i<e.posts.length;i++)if(e.posts[i].startTime&&e.posts[i].endTime){if("1005"==e.posts[i].type){var o=s("date")(e.posts[i].startTime,"HH");if(o<18)return void alert("夜宵的开始时间不得早于0点")}e.posts[i].startTime=s("date")(e.posts[i].startTime,"yyyy-MM-dd HH:mm:ss"),e.posts[i].endTime=s("date")(e.posts[i].endTime,"yyyy-MM-dd HH:mm:ss"),a.push(e.posts[i])}console.log(a),sendJson=angular.toJson(a),sendre=ajaxSendFn(sendJson,"/businesstimes","POST",1),200==sendre.code&&t.path("/shop/add4")}}]),app.controller("ShopAdd4Ctr",["$scope","$location","$filter",function(e,t,s){re=ajaxSendFn({},"/staffs/shop","GET").result||[],e.posts={staff:[]},e.sendok=re?re.items:[],e.addStaffFn=function(){e.posts.staff.push({code:"",name:"",tel:"",password:""})},console.log(e.sendok),e.sendok||e.addStaffFn(),e.removeStaffFn=function(t){e.posts.staff.splice(t,1)},e.sendposts=function(){for(var s=[],a=0;a<e.posts.staff.length;a++)json={},json.name=e.posts.staff[a].name,json.password=hex_md5(e.posts.staff[a].password),json.roleType="S",json.nickname=e.posts.staff[a].nickname,json.shopId=e.config.staff.shopId,re=ajaxSendFn(angular.toJson(json),"/staffs/staff","POST",1),200==re.code?(e.sendok.push(e.posts.staff[a]),s.push(a)):e.posts.staff[a].error="错误";s.sort();for(var o=s.length-1;o>=0;o--)e.posts.staff.splice(s[o],1);e.posts.staff.length<1&&e.sendok&&t.path("/shop/add5")}}]),app.controller("ShopAdd5Ctr",["$scope","$location","$filter",function(e,t,s){}]),app.controller("StaffShowCtr",["$scope","$location",function(e,t){e.user={},e.user.list={keeper:[],staffs:[]},e.config.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/staff"},{name:"员工列表"}],e.user.get=ajaxSendFn({},constUrlDict["staffs-shop"],"GET").result.items,e.user.get=e.user.get?e.user.get:"";for(var s=0;s<e.user.get.length;s++)"K"==e.user.get[s].roleType?e.user.list.keeper=e.user.get[s]:e.user.list.staffs.push(e.user.get[s]);e.staffDelFn=function(t){return!!confirm("一旦删除将不可恢复，是否确认删除？")&&(staffDelRe=ajaxSendFn({},constUrlDict["staffs-base"]+"/"+e.user.list.staffs[t].id,"POST"),void(200==staffDelRe.code?e.user.list.staffs.splice(t,1):errorMsg(staffDelRe)))},e.keepperDelFn=function(){return!!confirm("一旦删除将不可恢复，是否确认删除？")&&(staffDelRe=ajaxSendFn({},constUrlDict["staffs-base"]+"/"+e.user.list.keeper.id,"POST"),void(200==staffDelRe.code?e.user.list.keeper=null:errorMsg(staffDelRe)))}}]),app.controller("StaffeditCtr",["$scope","$location","$routeParams",function(e,t,s){e.show={},e.posts={},e.staffadd_form={},e.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/Staff"},{name:"编辑员工"}],e.staffget=ajaxSendFn({},constUrlDict.staff+"/"+s.guestid,"GET").result,e.staffadd_form.submitted=!1,e.posts.gender=e.staffget.gender,e.posts.nickname=e.staffget.nickname,e.posts.shopId=e.staffget.shopId,e.show.shopname=ajaxSendFn({},"/shops/shop","GET").result.name,e.staffaddsend=function(){e.posts.shopId=e.staffget.shopId,sendJson=JSON.stringify(e.posts),result=ajaxSendFn(sendJson,constUrlDict.staff+"/"+e.staffget.id,"POST",1),200==result.code?(alert("修改成功"),t.path("/staff")):errorMsg(result)}}]),app.controller("StaffdutyeditCtr",["$scope","$location","$routeParams",function(e,t,s){e.show={},e.view={tables:[],boxs:[]},e.posts={tables:[]},e.staffadd_form={},e.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/Staff/dutyedit"},{name:"编辑员工"}],e.view.tables=ajaxSendFn({},constUrlDict.tables,"GET").result;var a=ajaxSendFn({},"/duty/staff/"+s.guestid,"GET");e.view.userTables=a.result,a.result.dutyTables&&angular.forEach(e.view.tables,function(e,t){for(var s=0;s<a.result.dutyTables.length;s++)e.no==a.result.dutyTables[s].no&&(this[t]=e.id)},e.posts.tables),e.checkAllTables=function(){e.tablesAll?e.posts.tables=[]:angular.forEach(e.view.tables,function(e,t){this[t]=e.id},e.posts.tables)},e.postSend=function(){var s={};s[e.view.userTables.staffId]=remove_empty(e.posts.tables);var a=ajaxSendFn(JSON.stringify(s),"/duty","POST");200==a.code?t.path("/staff"):alert(a.message)}}]),app.controller("StaffaddCtr",["$scope","$location",function(e,t){e.config.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/staff"},{name:"添加员工"}],e.posts={},e.staffadd_form={submitted:!1},e.textCheckJson=textCheckJson,e.textCheckErrorJson=textCheckErrorJson,e.posts.gender=0,e.staffaddsend=function(s){var a={};angular.extend(a,e.posts),a.shopId=e.config.staff.shopId,a.roleType="keeper"==s?"K":"S",a.password=hex_md5(e.posts.password),a=JSON.stringify(a),result=ajaxSendFn(a,constUrlDict.staff,"POST",1),200==result.code?(alert("添加成功"),t.path("/staff")):errorMsg(result)}}]),app.controller("ShopBusinesstimeCtr",["$scope","$filter","$location",function(e,t,s){e.view={table:{1001:{type:"1001",startTime:"",endTime:"",show:0,buname:"早市"},1002:{type:"1002",startTime:"",endTime:"",show:0,buname:"午市"},1003:{type:"1003",startTime:"",endTime:"",show:0,buname:"下午茶"},1004:{type:"1004",startTime:"",endTime:"",show:0,buname:"晚市"},1005:{type:"1005",startTime:"",endTime:"",show:0,buname:"宵夜"}}},e.getTimeFn=function(){for(e.view.businesstime=ajaxSendFn({},constUrlDict.businesstimes,"GET").result,i=0;e.view.businesstime&&i<e.view.businesstime.length;i++)key=e.view.businesstime[i].type,name=e.view.table[e.view.businesstime[i].type].buname,e.view.table[key]=e.view.businesstime[i],e.view.table[key].show=1,e.view.table[key].buname=name,e.view.table[key].startTime=new Date(Date.parse("2000-01-01 "+e.view.table[key].startTime.replace(/-/g,"/"))),e.view.table[key].endTime=new Date(Date.parse("2000-01-01 "+e.view.table[key].endTime.replace(/-/g,"/")))},e.getTimeFn(),e.addFn=function(t){e.view.table[t].show=1},e.saveFn=function(){var a=[];for(var o in e.view.table)if(e.view.table[o].startTime&&e.view.table[o].endTime){var n={};if(n.startTime=e.view.table[o].startTime,n.type=e.view.table[o].type,n.endTime=e.view.table[o].endTime,n.endTime=t("date")(n.endTime,"yyyy-MM-dd HH:mm:ss"),n.startTime=t("date")(n.startTime,"yyyy-MM-dd HH:mm:ss"),e.view.table[o].id&&(n.id=e.view.table[o].id),"1005"==n.type){var r=t("date")(e.view.table[o].startTime,"HH");if(r<18)return void alert("夜宵的开始时间不得早于0点")}a.push(n)}sendJson=JSON.stringify(a),result=ajaxSendFn(sendJson,constUrlDict.businesstimes,"POST",1),200!=result.code?errorMsg(result):(e.getTimeFn(),s.path("/shop"))},e.delFn=function(t){return e.view.table[t].id&&(result=ajaxSendFn({},constUrlDict.businesstimes+"/"+e.view.table[t].id,"POST"),200!=result.code)?void console.error(result):void(e.view.table[t]={type:t,startTime:"",endTime:"",show:0,buname:e.view.table[t].buname})}}]),app.controller("ShoptablesCtr",["$scope","$filter",function(e,t){e.config.breadset=[{name:"桌台管理",href:indexUrl+"/keeper.html#/tables"},{name:"查看桌台"}];var s={};e.view={tables:[],boxs:[]},undoAction=function(){var t="1001"===s.type?e.view.tables:e.view.boxs;for(i=0,l=t.length;i<l;i++)s.id===t[i].id&&(t[i].seatNum=s.seatNum,t[i].no=s.no,t[i].name=s.name)},makeAction=function(t,s,a,o,n){return function(){delete e.post.show,delete e.post.isOwner,"1001"===e.post.type&&delete e.post.name,e.post.seatNum=parseInt(e.post.seatNum),json=e.post,sendJson=angular.toJson(json),result=ajaxSendFn(sendJson,t(e.post),a,1),200!=result.code?(errorMsg(result),n&&undoAction()):o(result,e.post),$("#addtable").modal("hide")}},e.actionhandle={add:makeAction(function(e){return constUrlDict["tables-table"]},function(e){return[e]},"POST",function(t,s){"1001"==s.type?e.view.tables.push(s):e.view.boxs.push(s)},!1),edit:makeAction(function(e){return e.id?constUrlDict["tables-table"]+"/"+e.id:void alert("暂时无法编辑，请刷新后重试")},null,"POST",function(){alert("修改成功")},!0)},e.view.shopId=ajaxSendFn({},"/shops/shop","GET").result.id,e.getTables=function(){if(gettables=ajaxSendFn({},constUrlDict.tables,"GET").result,gettables)for(var t=0;t<gettables.length;t++)1001==gettables[t].type?e.view.tables.push(gettables[t]):e.view.boxs.push(gettables[t])},e.tem={},e.modaladd=function(t){e.post={},e.view.action="add","table"==t?(e.post.type="1001",e.view.modalname="添加散台",e.tem.nameshow=0):(e.post.type="1002",e.view.modalname="添加包厢",e.tem.nameshow=1),$("#addtable").modal("show")},e.dispatchAction=function(){e.actionhandle[e.view.action]()},e.cancelAction=function(){undoAction()},e.tableDelFn=function(t,s){del=ajaxSendFn({},constUrlDict.tables+"/"+t.id,"POST"),200!=del.code?errorMsg(del):"1001"===t.type?e.view.tables.splice(s,1):e.view.boxs.splice(s,1)},e.editTableFn=function(t,a){e.post=e.view[t][a],angular.extend(s,e.post),e.view.action="edit","tables"==t?(e.view.modalname="修改散台",e.tem.nameshow=0):(e.view.modalname="修改包厢",e.tem.nameshow=1),$("#addtable").modal("show")},e.getTables(),e.sendposts=function(){var t=0;e.view.table.length>0&&(sendJson=angular.toJson(e.view.table),send1=ajaxSendFn(sendJson,"/tables","POST",1),200==send1.code&&t++),e.view.box.length>0&&(sendJson2=angular.toJson(e.view.box),send2=ajaxSendFn(sendJson2,"/tables/box","POST",1),200==send2.code&&t++),t>0&&$location.path("/shop/add3")}}]),app.controller("CommentCtr",["$scope",function(e){e.config.breadset=[{name:"活动",href:indexUrl+"/keeper.html#/rule"},{name:"顾客评论"}];var t=ajaxSendFn({},"/shops/shop/comment","GET").result;t&&(e.view={comment:t.items||[]},e.view.satisfaction={1001:"很棒",1002:"一般",1003:"较差"})}]),app.controller("CustomerCtr",["$scope","tyFnFactory","$http",function(e,t,s){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客列表"}],e.dict={source:{9001:"上宾",9002:"手动"},cardType:{v_card:"电子卡",p_card:"实物卡",b_card:"绑定卡"},memberType:[{name:"所有顾客",key:""},{name:"会员",key:"MEMBER"}]},e.view={interest:{}},s.get(basicUrl+"/customer?"+sortUrl()).then(function(t){e.view.customer=t.data.result||[]},function(e){console.log(e)}),e.view.member=[],e.search={},e.postSend=function(){e.search.param?(e.view.customer.total=0,e.view.customer.items=ajaxSendFn(e.search,"/customer/search","GET").result||[]):e.view.customer=ajaxSendFn({},"/customer","GET").result||[]},e.interestGetFn=function(t){e.view.interest[t]||(e.view.interest[t]=ajaxSendFn({userId:t},"/benefit","GET").result||[])},e.pageChange=function(){var t={page:e.view.customer.page,count:e.view.customer.count};e.view.customer=ajaxSendFn(t,"/customer","GET").result||[]}}]),app.controller("CustomerChargeCtr",["$scope","$routeParams","$filter","$http",function(e,t,s,a){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客充值"}],e.view={},e.reason={use:"use",add:""},a.get(basicUrl+constUrlDict.customer+"/"+t.userId+"?"+sortUrl()).success(function(t){console.log(t),e.view.user=t.result||[]}),e.view.interest=ajaxSendFn({userId:t.userId},constUrlDict.benefit,"GET").result||[],e.send=function(){json={},json.users=t.userId,json.charge=e.posts.charge,json.reason="SHOP_GRANT",reason=e.reason[e.posts.type],re=ajaxSendFn(json,concatUrl(constUrlDict.benefit,reason),"POST",1),200==re.code?(e.view.interest=ajaxSendFn({userId:t.userId},constUrlDict.benefit,"GET").result||[],e.posts.charge=0,alert(reason+"成功")):errorMsg(re)}}]),app.controller("CustomerPoicustomerntCtr",["$scope","$routeParams",function(e,t){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客积分"}],e.view={user:ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[]},e.reason={use:"use",add:""},e.view.interest=ajaxSendFn({userId:t.userId},constUrlDict.benefit,"GET").result||[],e.send=function(){console.log(e.posts),json={},json.users=t.userId,json.point=e.posts.point,json.reason="SHOP_GRANT",reason=e.reason[e.posts.type],re=ajaxSendFn(JSON.stringify(json),concatUrl(constUrlDict.benefit,reason),"POST",1),200==re.code?(e.view.interest=ajaxSendFn({userId:t.userId},constUrlDict.benefit,"GET").result||[],e.posts.point=0,alert(reason+"成功")):errorMsg(re)}}]),app.controller("CustomerCouponCtr",["$scope","$routeParams",function(e,t){e.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"顾客发券"}],e.view={user:ajaxSendFn({},constUrlDict.customer+"/"+t.userId,"GET").result||[]},e.posts={},e.view.coupons=ajaxSendFn({},constUrlDict.coupon,"GET").result||[],console.log(e.view.coupons),e.view.coupons.length>0&&(e.posts.coupons=[{id:e.view.coupons[0].id,count:1}]),e.add=function(){e.view.coupons.length>0&&(e.posts.coupons.push({id:e.view.coupons[0].id,count:1}),console.log(e.posts.coupons))},e.remove=function(t){e.posts.coupons.splice(t,1)},e.canSend=function(){return e.view.coupons&&e.view.coupons.length>0},e.send=function(){json={},json.users=t.userId,e.posts.coupons&&e.posts.coupons.length>0&&(console.log(e.posts.coupons),json.coupons=e.posts.coupons,json.reason="SHOP_GRANT",console.log(e.posts),re=ajaxSendFn(JSON.stringify(json),constUrlDict.benefit,"POST",1),200==re.code?alert("赠券成功"):errorMsg(re))}}]),app.controller("CustomerAddCtr",["$interval","$scope","$location","$filter",function(e,t,s,a){t.config.breadset=[{name:"顾客管理",href:indexUrl+"/keeper.html#/customer"},{name:"添加会员"}],t.view={member:ajaxSendFn({},"/memberGrade","GET").result||[],repeats:90},t.posts={birthday:""},t.getValidateCode=function(e){t.posts.phone&&(re=ajaxSendFn({phone:t.posts.phone},"/customer/validate","POST"),200==re.code?console.log("验证码发送成功"):(alert(re.message),s.path("/customer")))},t.send=function(){t.posts.birthday=a("date")(t.posts.birthday,"yyyy-MM-dd"),re=ajaxSendFn(t.posts,"/customer","POST"),200==re.code?(alert("添加成功"),s.path("/customer")):errorMsg(re)}}]),app.controller("RuleCtr",["$scope","$location","$filter",function(e,t,s){e.config.breadset=[{name:"活动管理",href:indexUrl+"/keeper.html#/rule"},{name:"活动列表"}],rule=ajaxSendFn({},"/activity","GET").result||[],e.ruleDic={nonParticipations:"不参与活动商品",periods:"有效时段",time:"时间",shops:"分店"},e.view={},e.view.rule=s("orderBy")(rule,"createTime",!0);for(x in e.view.rule){tem=e.view.rule[x],e.view.rule[x].icon={};for(y in tem.rules)tem.rules[y].type=tem.rules[y].type.split("_"),e.view.rule[x].icon[tem.rules[y].type[0]]=1}e.pannel=function(t){id=e.view.rule[t]._id,(e.view.rule[t].rulesget||(tem=ajaxSendFn({},"/activity/"+id+"/rules","GET"),200==tem.code?e.view.rule[t].rulesget=tem.result:e.view.rule[t].rulesget={result:{"结果":"没有找到"}},e.view.rule[t].rulesget))&&($.each(e.view.rule,function(t){e.view.rule[t].show=0}),e.view.rule[t].show=1)}}]),app.controller("RulememberCtr",["$scope","$filter","$http",function(e,t,s){e.config.breadset=[{name:"活动管理",href:indexUrl+"/keeper.html#/rule"},{name:"会员规则管理"}],e.view={member:[]},e.costType={BUY:{start:"花费",end:"元购买,"},POINT_EXCHANGE:{start:"花费",end:"积分兑换,"},POINT:{start:"累计",end:"积分,"},CHARGE:{start:"充值",end:"元,"},SINGLE_COST:{start:"单次消费",end:"元"},FREE:{start:"",end:"免费领卡"}},s.get(basicUrl+"/memberGrade").success(function(s){e.view.member=t("orderBy")(s.result,"grade",!1)}),e.type={BUY:"购买"},e.memberUpgradeSHow=function(t){e.view.member[t].memberGrade||(e.view.member[t].memberGrade=ajaxSendFn({},"/memberUpgrade/toId/"+e.view.member[t].id,"GET").result||[]),e.view.plan=e.view.member[t],e.planShow=!0},e.closeFn=function(){e.planShow=!1}}]),app.controller("passwordCtr",["$scope","$location","$routeParams",function(e,t,s){e.posts={},e.staffadd_form={},e.config.breadset=[{name:"员工管理",href:indexUrl+"/keeper.html#/Staff"},{name:"重设密码"}],e.staffget=ajaxSendFn({},constUrlDict.staff+"/"+s.guestid,"GET").result,e.textCheckJson=textCheckJson,e.textCheckErrorJson=textCheckErrorJson,e.staffadd_form.submitted=!1,e.staffget.shopname=ajaxSendFn({},"/shops/shop","GET").result.name,e.staffaddsend=function(){if(!e.staffadd_form.$valid)return void(e.staffadd_form.submitted=!0);var s={};angular.extend(s,e.posts),s.password=hex_md5(e.posts.password),result=ajaxSendFn(s,constUrlDict["staffs-password"]+"/"+e.staffget.id,"POST"),200==result.code?(alert("修改成功"),t.path("/staff")):errorMsg(result)}}]),app.controller("edit_passwordCtr",["$scope","$location",function(e,t){e.show={},e.posts={},e.staffadd_form={},e.config.breadset=[{name:"修改密码"}],e.staffaddsend=function(){if(!e.staffadd_form.$valid)return void(e.staffadd_form.submitted=!0);if(e.posts.oldPassword===e.posts.password)return void alert("原密码和新密码不能相同");var s={};s.old=hex_md5(e.posts.oldPassword),s.password=hex_md5(e.posts.password),result=ajaxSendFn(s,constUrlDict["staffs-password"],"POST"),200==result.code?(alert("修改成功"),t.path("/")):4102==result.code?alert("原密码不匹配，请重试"):errorMsg(result)}}]),app.controller("DevicesCtr",["$scope","$http","deviceFactory",function(e,t,s){e.config.breadset=[{name:"设备管理",href:indexUrl+"/admin.html#/devices"},{name:"设备列表"}],e.search={count:10},e.getDevices=function(){e.view={devices:s.getAllDevices(e.search)}},e.jihuo=function(){s.jihuo(function(t){e.getDevices()})},e.pageChange=function(){e.search.page=e.view.devices.page,e.getDevices()},e.unbind=function(t){var s=ajaxSendFn({},"/activate/"+e.view.devices.items[t].id,"POST");200==s.code?(alert("解绑成功！"),e.getDevices()):alert(s.message)},e.getDevices()}]),app.controller("DishCtr",["$scope","$location","$http",function(e,t,s){e.config.breadset=[{name:"菜品管理",href:indexUrl+"/keeper.html#/dish"},{name:"菜品列表"}];var a=ajaxSendFn({},"/dishes","GET");e.dishes={list:a.result}}]),app.controller("DocCtr",["$rootScope","$scope","$location","shopFactory",function(e,t,s,a){t.config.breadset=[],t.config.class="doc",t.posts={shopId:"brand"},t.view={STATISTICS_TEXT:["当前总余额（元）","当前总余量（分）","当前总余量（张）","当前会员总人数（人）","历史总计（条）","当前总消费数（笔）","当前总消费数（笔）"],buttons:["充值报表","积分报表","优惠券报表","顾客升级情况报表","短信使用情况报表","上宾消费报表","其他收费报表"],coupons:ajaxSendFn({},"/statistics/coupons","GET").result||[]},t.sendOrder=function(){s.path("/doc/detail/"+t.posts.order)}}]);